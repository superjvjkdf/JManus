import{_ as po}from"./Java-AI-BYpq8IxI.js";import{d as Ee,u as De,a as g,b as h,n as ge,e as o,f as B,g as x,i as p,h as me,t as c,y as Ye,F as fe,q as ye,j as $e,l as Se,A as ys,c as re,B as He,r as A,o as Me,C as be,D as Ue,w as we,m as Ce,E as Bt,G as Dt,v as mo,H as bs,I as Ne,J as _s,z as xe,T as _t,p as ze,K as ws,M as ho,N as ot,O as fo,x as vo}from"./index-DDyEo--X.js";import{I as F,_ as ke}from"./_plugin-vue_export-helper-CteboPq4.js";import{u as yt,m as Ie,P as go,D as Yt,a as Ge,t as pe,s as $s}from"./templateStore-CL_yjOzv.js";import{P as Qt,L as yo}from"./plan-template-with-tool-api-service-BZqjfE8u.js";import{M as Ss,u as wt,a as bo,b as Ps}from"./useToast-D_8pUq38.js";import"./llm-check-CJy4TeZw.js";const _o={class:"sub-plan-info"},wo={class:"sub-plan-details"},$o={class:"sub-plan-title"},So={key:0,class:"nesting-level"},Po={class:"sub-plan-id"},To={class:"sub-plan-meta"},Eo={key:0,class:"trigger-tool"},ko={class:"trigger-text"},Co={key:0,class:"sub-plan-progress"},Io={class:"progress-info"},Ro={class:"progress-text"},xo={class:"progress-bar"},Ao={key:1,class:"sub-plan-agents-steps"},Fo={class:"agents-steps-header"},Mo={class:"agents-label"},Do={class:"agents-steps-list"},No=["onClick"],Uo={class:"agent-step-header"},Lo=["title"],Oo={class:"sub-agent-execution-info"},qo={key:0,class:"agent-result"},Bo={class:"result-header"},Ho={class:"result-label"},Vo={class:"result-content"},jo={key:1,class:"agent-error"},zo={class:"error-header"},Wo={class:"error-label"},Go={class:"error-content"},Ko={key:2,class:"think-act-preview"},Jo={class:"think-act-header"},Xo={class:"think-act-label"},Yo={class:"think-act-steps-preview"},Qo=["onClick"],Zo={class:"step-number"},en={class:"step-description"},tn={key:0,class:"more-steps"},sn={class:"more-steps-text"},on={key:3,class:"nested-sub-plans"},nn={class:"nested-sub-plans-header"},an={class:"nested-label"},ln={class:"nested-sub-plans-list"},rn={key:4,class:"direct-sub-plans"},cn={class:"direct-sub-plans-header"},un={class:"direct-label"},dn={class:"direct-sub-plans-list"},pn=Ee({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=n,s=t,{t:a}=De(),l=()=>`nesting-level-${e.nestingLevel}`,r=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(U=>U.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(U=>U.status==="FINISHED")?"in-progress":"pending",d=()=>{switch(r()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},y=()=>{switch(r()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const b=i();return Math.min(100,b/e.subPlan.agentExecutionSequence.length*100)},i=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(b=>b.status==="FINISHED").length:0,f=b=>{switch(b){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},k=b=>{switch(b){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},E=b=>{switch(b){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},m=b=>b.thinkActSteps?.some(P=>P.subPlanExecutionRecord)??!1,S=b=>b.thinkActSteps?.filter(P=>P.subPlanExecutionRecord)??[],w=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},v=(b,P)=>{const U=P.stepId??`subplan-${e.subPlanIndex}-agent-${b}`;s("step-selected",U)},N=(b,P,U)=>{const D=U.stepId??`subplan-${e.subPlanIndex}-agent-${b}`;s("step-selected",D)},W=(b,P,U)=>{s("sub-plan-selected",b,P,U)},L=b=>{s("step-selected",b)};return(b,P)=>{const U=ys("RecursiveSubPlan",!0);return h(),g("div",{class:ge(["recursive-sub-plan",l()])},[o("div",{class:"sub-plan-header",onClick:w},[o("div",_o,[x(p(F),{icon:y(),class:"sub-plan-status-icon"},null,8,["icon"]),o("div",wo,[o("div",$o,[me(c(b.subPlan.title||b.$t("chat.subPlan"))+" #"+c(b.subPlanIndex+1)+" ",1),(b.nestingLevel??0)>0?(h(),g("span",So,"(L"+c((b.nestingLevel??0)+1)+")",1)):B("",!0)]),o("div",Po,c(b.subPlan.currentPlanId),1)])]),o("div",To,[o("div",{class:ge(["sub-plan-status-badge",r()])},c(d()),3),b.subPlan.parentActToolCall?(h(),g("div",Eo,[x(p(F),{icon:"carbon:function",class:"trigger-icon"}),o("span",ko,c(b.subPlan.parentActToolCall.name),1)])):B("",!0)])]),b.subPlan.agentExecutionSequence?.length?(h(),g("div",Co,[o("div",Io,[o("span",Ro,c(b.$t("chat.progress"))+": "+c(i())+" / "+c(b.subPlan.agentExecutionSequence.length),1),o("div",xo,[o("div",{class:"progress-fill",style:Ye({width:u()+"%"})},null,4)])])])):B("",!0),b.subPlan.agentExecutionSequence?.length?(h(),g("div",Ao,[o("div",Fo,[o("span",Mo,c(b.$t("chat.agentExecutions"))+":",1)]),o("div",Do,[(h(!0),g(fe,null,ye(b.subPlan.agentExecutionSequence,(D,q)=>(h(),g("div",{key:D.id||q,class:ge(["agent-step-item",f(D.status)]),onClick:$=>v(q,D)},[o("div",Uo,[x(p(F),{icon:k(D.status),class:"agent-icon"},null,8,["icon"]),o("span",{class:"agent-name",title:D.agentName==="ConfigurableDynaAgent"?b.$t("chat.clickToViewExecutionDetails"):""},c(D.agentName==="ConfigurableDynaAgent"?b.$t("chat.funcAgentExecutionDetails"):D.agentName||b.$t("chat.unknownAgent")),9,Lo),o("div",{class:ge(["agent-status-badge",f(D.status)])},c(E(D.status)),3)]),o("div",Oo,[D.result?(h(),g("div",qo,[o("div",Bo,[x(p(F),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Ho,c(b.$t("chat.agentResult"))+":",1)]),o("pre",Vo,c(D.result),1)])):B("",!0),D.errorMessage?(h(),g("div",jo,[o("div",zo,[x(p(F),{icon:"carbon:warning",class:"error-icon"}),o("span",Wo,c(b.$t("chat.errorMessage"))+":",1)]),o("pre",Go,c(D.errorMessage),1)])):B("",!0),D.thinkActSteps?.length?(h(),g("div",Ko,[o("div",Jo,[x(p(F),{icon:"carbon:thinking",class:"think-act-icon"}),o("span",Xo,c(b.$t("chat.thinkActSteps"))+" ("+c(D.thinkActSteps.length)+")",1)]),o("div",Yo,[(h(!0),g(fe,null,ye(D.thinkActSteps.slice(0,b.maxVisibleSteps??2),($,I)=>(h(),g("div",{key:$.id||I,class:"think-act-step-preview",onClick:$e(T=>N(q,I,D),["stop"])},[o("span",Zo,"#"+c(I+1),1),o("span",en,c($.actionDescription||b.$t("chat.thinking")),1),x(p(F),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Qo))),128)),D.thinkActSteps.length>(b.maxVisibleSteps??2)?(h(),g("div",tn,[o("span",sn,c(b.$t("chat.andMoreSteps",{count:D.thinkActSteps.length-(b.maxVisibleSteps??2)})),1)])):B("",!0)])])):B("",!0),m(D)?(h(),g("div",on,[o("div",nn,[x(p(F),{icon:"carbon:tree-view-alt",class:"nested-icon"}),o("span",an,c(b.$t("chat.nestedSubPlans")),1)]),o("div",ln,[(h(!0),g(fe,null,ye(S(D),($,I)=>(h(),Se(U,{key:$.id||I,"sub-plan":$.subPlanExecutionRecord,"sub-plan-index":I,"nesting-level":(b.nestingLevel??0)+1,"max-nesting-depth":b.maxNestingDepth??3,"max-visible-steps":b.maxVisibleSteps??2,onSubPlanSelected:W,onStepSelected:L},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0),D.subPlanExecutionRecords?.length?(h(),g("div",rn,[o("div",cn,[x(p(F),{icon:"carbon:tree-view",class:"direct-icon"}),o("span",un,c(b.$t("chat.directSubPlans")),1)]),o("div",dn,[(h(!0),g(fe,null,ye(D.subPlanExecutionRecords,($,I)=>(h(),Se(U,{key:$.currentPlanId||I,"sub-plan":$,"sub-plan-index":I,"nesting-level":(b.nestingLevel??0)+1,"max-nesting-depth":b.maxNestingDepth??3,"max-visible-steps":b.maxVisibleSteps??2,onSubPlanSelected:W,onStepSelected:L},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0)])],10,No))),128))])])):B("",!0)],2)}}}),mn=ke(pn,[["__scopeId","data-v-36486b62"]]),hn={class:"execution-details"},fn={key:0,class:"plan-overview"},vn={key:0,class:"parent-tool-call"},gn={class:"parent-tool-header"},yn={class:"tool-label"},bn={class:"tool-name"},_n={key:0,class:"tool-parameters"},wn={class:"param-label"},$n={class:"param-content"},Sn={key:1,class:"agent-execution-container"},Pn={class:"section-title"},Tn=["onClick"],En={class:"agent-info"},kn={class:"agent-details"},Cn=["title"],In={class:"request-content"},Rn={class:"agent-controls"},xn={class:"agent-execution-info"},An={key:0,class:"agent-result"},Fn={class:"result-header"},Mn={class:"result-label"},Dn={class:"result-content"},Nn={key:1,class:"agent-error"},Un={class:"error-header"},Ln={class:"error-label"},On={class:"error-content"},qn={key:0,class:"sub-plans-container"},Bn={class:"sub-plans-header"},Hn={class:"sub-plans-title"},Vn={class:"sub-plans-list"},jn=Ee({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=f=>{f.stepId?e("step-selected",f.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",f)},l=f=>{switch(f){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},r=f=>{switch(f){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},d=f=>{switch(f){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},y=(f,k,E)=>{e("sub-plan-selected",f,k,E)},u=f=>{e("step-selected",f)},i=f=>{if(!f)return"";try{const k=JSON.parse(f);return JSON.stringify(k,null,2)}catch{return f}};return(f,k)=>(h(),g("div",hn,[f.planExecution?(h(),g("div",fn,[f.planExecution.parentActToolCall?(h(),g("div",vn,[o("div",gn,[x(p(F),{icon:"carbon:flow",class:"tool-icon"}),o("span",yn,c(f.$t("chat.triggeredByTool"))+":",1),o("span",bn,c(f.planExecution.parentActToolCall.name),1)]),f.planExecution.parentActToolCall.parameters?(h(),g("div",_n,[o("span",wn,c(f.$t("common.parameters"))+":",1),o("pre",$n,c(i(f.planExecution.parentActToolCall.parameters)),1)])):B("",!0)])):B("",!0)])):B("",!0),(f.planExecution?.agentExecutionSequence?.length??0)>0?(h(),g("div",Sn,[o("h4",Pn,c(f.$t("chat.agentExecutionSequence")),1),(h(!0),g(fe,null,ye(f.planExecution?.agentExecutionSequence,(E,m)=>(h(),g("div",{key:E.id||m,class:ge(["agent-execution-item",l(E.status)])},[o("div",{class:"agent-header",onClick:S=>a(E)},[o("div",En,[x(p(F),{icon:d(E.status),class:"agent-status-icon"},null,8,["icon"]),o("div",kn,[o("div",{class:"agent-name",title:E.agentName==="ConfigurableDynaAgent"?f.$t("chat.clickToViewExecutionDetails"):""},c(E.agentName==="ConfigurableDynaAgent"?f.$t("chat.funcAgentExecutionDetails"):E.agentName||f.$t("chat.unknownAgent")),9,Cn),o("pre",In,c(E.agentRequest),1)])]),o("div",Rn,[o("div",{class:ge(["agent-status-badge",l(E.status)])},c(r(E.status)),3),x(p(F),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Tn),o("div",xn,[E.result?(h(),g("div",An,[o("div",Fn,[x(p(F),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Mn,c(f.$t("chat.agentResult"))+":",1)]),o("pre",Dn,c(E.result),1)])):B("",!0),E.errorMessage?(h(),g("div",Nn,[o("div",Un,[x(p(F),{icon:"carbon:warning",class:"error-icon"}),o("span",Ln,c(f.$t("chat.errorMessage"))+":",1)]),o("pre",On,c(E.errorMessage),1)])):B("",!0)]),E.subPlanExecutionRecords?.length?(h(),g("div",qn,[o("div",Bn,[x(p(F),{icon:"carbon:tree-view",class:"sub-plans-icon"}),o("span",Hn,c(f.$t("chat.subPlanExecutions"))+" ("+c(E.subPlanExecutionRecords.length)+") ",1)]),o("div",Vn,[(h(!0),g(fe,null,ye(E.subPlanExecutionRecords,(S,w)=>(h(),Se(mn,{key:S.currentPlanId||w,"sub-plan":S,"sub-plan-index":w,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:y,onStepSelected:u},null,8,["sub-plan","sub-plan-index"]))),128))])])):B("",!0)],2))),128))])):B("",!0)]))}}),zn=ke(jn,[["__scopeId","data-v-ee75d960"]]);function Ts(){return{formatResponseText:y=>y?y.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:y=>{if(!y||isNaN(y.getTime()))return"";const i=new Date().getTime()-y.getTime();if(i<6e4)return"Just now";if(i<36e5)return`${Math.floor(i/6e4)} minutes ago`;if(i<864e5)return`${Math.floor(i/36e5)} hours ago`;try{return y.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(f){return console.warn("[useMessageFormatting] Error formatting timestamp:",y,f),""}},getMessageClasses:y=>re(()=>({user:y.type==="user",assistant:y.type==="assistant",streaming:y.isStreaming,"has-error":!!y.error,"has-thinking":!!y.thinking,"has-execution":!!y.planExecution})),formatFileSize:y=>{if(y===0)return"0 B";const u=1024,i=["B","KB","MB","GB"],f=Math.floor(Math.log(y)/Math.log(u));return parseFloat((y/Math.pow(u,f)).toFixed(2))+" "+i[f]},truncateText:(y,u=100)=>!y||y.length<=u?y:y.substring(0,u)+"...",stripHtml:y=>y.replace(/<[^>]*>/g,""),hasDisplayableContent:y=>!!(y.content||(y.thinking??!1)||(y.planExecution??!1)||y.error),getMessageStatus:y=>y.error?"Send failed":y.isStreaming?"Typing...":y.type==="assistant"&&!y.content&&!y.thinking?"Waiting for response":""}}class Nt{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const Wn={class:"user-input-form-container"},Gn={class:"user-input-header"},Kn={class:"user-input-title"},Jn={class:"user-input-message"},Xn={key:0,class:"form-description"},Yn={key:0,class:"form-grid"},Qn=["for"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","placeholder","required","onUpdate:modelValue"],sa=["id","name","placeholder","required","onUpdate:modelValue"],oa=["id","name","placeholder","required","onUpdate:modelValue"],na=["id","name","required","onUpdate:modelValue"],aa={value:""},la=["value"],ra={key:6,class:"checkbox-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"checkbox-label"},ua={key:7,class:"radio-group"},da=["id","name","value","onUpdate:modelValue"],pa={class:"radio-label"},ma=["id","name","placeholder","required","onUpdate:modelValue"],ha={key:1,class:"form-group"},fa={for:"form-input-genericInput"},va={type:"submit",class:"submit-user-input-btn"},ga=Ee({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:t}){const e=n,s=t;De();const a=He({}),l=A(e.genericInput??""),r=A(!1),d=A(null),y=()=>{const k=e.userInputWaitState?.formInputs;k&&k.length>0&&(!r.value||Object.keys(a).length!==k.length)&&(k.forEach((m,S)=>{(!(S in a)||m.type==="checkbox"&&!Array.isArray(a[S])||m.type!=="checkbox"&&a[S]==="")&&(m.type==="checkbox"?a[S]=[]:a[S]="")}),r.value=!0)};Me(()=>{y()}),be(()=>e.userInputWaitState?.formInputs,()=>{d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{r.value=!1,y()},100)},{deep:!0});const u=async()=>{try{const k={},E=e.userInputWaitState?.formInputs;E&&E.length>0?Object.entries(a).forEach(([m,S])=>{const w=parseInt(m,10),N=E[w].label||`input_${m}`;Array.isArray(S)?k[N]=S.join(", "):k[N]=S}):k.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",k,"for planId:",e.planId),e.planId?(await Nt.submitFormInput(e.planId,k),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",k)}catch(k){console.error("[UserInputForm] User input submission failed:",k)}},i=k=>k?Array.isArray(k)?k:typeof k=="string"?k.split(",").map(E=>E.trim()).filter(E=>E.length>0):[]:[],f=k=>typeof k=="boolean"?k:typeof k=="string"?k==="true":!1;return Ue(()=>{d.value&&clearTimeout(d.value)}),(k,E)=>(h(),g("div",Wn,[o("div",Gn,[x(p(F),{icon:"carbon:user",class:"user-icon"}),o("h4",Kn,c(k.$t("chat.userInputRequired")),1)]),o("p",Jn,c(k.userInputWaitState?.title??k.$t("chat.userInput.message")),1),k.userInputWaitState?.formDescription?(h(),g("p",Xn,c(k.userInputWaitState?.formDescription),1)):B("",!0),o("form",{onSubmit:$e(u,["prevent"]),class:"user-input-form"},[k.userInputWaitState?.formInputs&&k.userInputWaitState.formInputs.length>0?(h(),g("div",Yn,[(h(!0),g(fe,null,ye(k.userInputWaitState?.formInputs,(m,S)=>(h(),g("div",{key:S,class:"form-group"},[o("label",{for:`form-input-${m.label.replace(/\W+/g,"_")}`},c(m.label)+c(f(m.required)?" *":"")+": ",9,Qn),!m.type||m.type==="text"?we((h(),g("input",{key:0,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":w=>a[S]=w,class:"form-input"},null,8,Zn)),[[Ce,a[S]]]):m.type==="email"?we((h(),g("input",{key:1,type:"email",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":w=>a[S]=w,class:"form-input"},null,8,ea)),[[Ce,a[S]]]):m.type==="number"?we((h(),g("input",{key:2,type:"number",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":w=>a[S]=w,class:"form-input"},null,8,ta)),[[Ce,a[S]]]):m.type==="password"?we((h(),g("input",{key:3,type:"password",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":w=>a[S]=w,class:"form-input"},null,8,sa)),[[Ce,a[S]]]):m.type==="textarea"?we((h(),g("textarea",{key:4,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":w=>a[S]=w,class:"form-input form-textarea",rows:"4"},null,8,oa)),[[Ce,a[S]]]):m.type==="select"&&m.options?we((h(),g("select",{key:5,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,required:f(m.required),"onUpdate:modelValue":w=>a[S]=w,class:"form-input form-select"},[o("option",aa,c(k.$t("selectCommon.pleaseSelect")),1),(h(!0),g(fe,null,ye(i(m.options),w=>(h(),g("option",{key:w,value:w},c(w),9,la))),128))],8,na)),[[Bt,a[S]]]):m.type==="checkbox"&&m.options?(h(),g("div",ra,[(h(!0),g(fe,null,ye(i(m.options),w=>(h(),g("label",{key:w,class:"checkbox-item"},[we(o("input",{type:"checkbox",id:`form-input-${m.label.replace(/\W+/g,"_")}-${w.replace(/\W+/g,"_")}`,name:m.label,value:w,"onUpdate:modelValue":v=>a[S]=v,class:"form-checkbox"},null,8,ia),[[Dt,a[S]]]),o("span",ca,c(w),1)]))),128))])):m.type==="radio"&&m.options?(h(),g("div",ua,[(h(!0),g(fe,null,ye(i(m.options),w=>(h(),g("label",{key:w,class:"radio-item"},[we(o("input",{type:"radio",id:`form-input-${m.label.replace(/\W+/g,"_")}-${w.replace(/\W+/g,"_")}`,name:m.label,value:w,"onUpdate:modelValue":v=>a[S]=v,class:"form-radio"},null,8,da),[[mo,a[S]]]),o("span",pa,c(w),1)]))),128))])):we((h(),g("input",{key:8,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":w=>a[S]=w,class:"form-input"},null,8,ma)),[[Ce,a[S]]])]))),128))])):(h(),g("div",ha,[o("label",fa,c(k.$t("common.input"))+":",1),we(o("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":E[0]||(E[0]=m=>l.value=m),class:"form-input"},null,512),[[Ce,l.value]])])),o("button",va,c(k.$t("chat.userInput.submit")),1)],32)]))}}),ya=ke(ga,[["__scopeId","data-v-e4d0802d"]]),ba={class:"response-section"},_a={class:"response-header"},wa={class:"response-avatar"},$a={class:"response-name"},Sa={key:0,class:"response-timestamp"},Pa={class:"response-content"},Ta={key:1,class:"final-response"},Ea=["innerHTML"],ka={class:"response-actions"},Ca=["title"],Ia=["title"],Ra={key:2,class:"response-placeholder"},xa={class:"typing-indicator"},Aa={class:"typing-text"},Fa={key:3,class:"response-error"},Ma={class:"error-text"},Da={key:4,class:"response-empty"},Na={class:"empty-text"},Ua=Ee({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:t}){const e=n,s=t,{formatResponseText:a,formatTimestamp:l}=Ts(),r=async()=>{if(e.content)try{const i=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(i),s("copy")}catch(i){console.error("Failed to copy to clipboard:",i)}},d=()=>{s("regenerate")},y=()=>{s("retry")},u=i=>{console.log("[ResponseSection] User input submitted:",i),s("user-input-submitted",i)};return(i,f)=>(h(),g("div",ba,[o("div",_a,[o("div",wa,[x(p(F),{icon:"carbon:bot",class:"bot-icon"})]),o("div",$a,c(i.$t("chat.botName")),1),i.timestamp?(h(),g("div",Sa,c(p(l)(i.timestamp)),1)):B("",!0)]),o("div",Pa,[i.userInputWaitState?.waiting?(h(),Se(ya,bs({key:0,"user-input-wait-state":i.userInputWaitState},i.planId?{"plan-id":i.planId}:{},{"generic-input":i.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):B("",!0),i.content?(h(),g("div",Ta,[o("div",{class:"response-text",innerHTML:p(a)(i.content)},null,8,Ea),o("div",ka,[o("button",{class:"action-btn copy-btn",onClick:r,title:i.$t("chat.copyResponse")},[x(p(F),{icon:"carbon:copy"})],8,Ca),o("button",{class:"action-btn regenerate-btn",onClick:d,title:i.$t("chat.regenerateResponse")},[x(p(F),{icon:"carbon:renew"})],8,Ia)])])):i.isStreaming?(h(),g("div",Ra,[o("div",xa,[f[0]||(f[0]=o("div",{class:"typing-dots"},[o("span"),o("span"),o("span")],-1)),o("span",Aa,c(i.$t("chat.thinkingResponse")),1)])])):i.error?(h(),g("div",Fa,[x(p(F),{icon:"carbon:warning",class:"error-icon"}),o("span",Ma,c(i.error),1),o("button",{class:"retry-btn",onClick:y},c(i.$t("chat.retry")),1)])):(h(),g("div",Da,[o("span",Na,c(i.$t("chat.waitingForResponse")),1)]))])]))}}),La=ke(Ua,[["__scopeId","data-v-a03ac86f"]]);function Oa(){const s=A(new Set),a=He(new Map),l=He(new Map),r=He(new Map),d=He(new Map),y=A(!1),u=A(null),i=P=>d.get(P),f=(P,U)=>{if(!P){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}d.set(P,U),console.log("[usePlanExecution] Cached plan record:",P)},k=()=>Array.from(s.value),E=P=>{if(!P){console.warn("[usePlanExecution] Cannot track empty planId");return}s.value.add(P),l.set(P,0),r.set(P,0),console.log("[usePlanExecution] Tracking plan:",P),u.value||v(),S(P).catch(U=>{console.error(`[usePlanExecution] Initial poll failed for ${P}:`,U)})},m=P=>{s.value.delete(P),l.delete(P),r.delete(P),console.log("[usePlanExecution] Untracking plan:",P),s.value.size===0&&a.size===0&&N()},S=async P=>{if(P)try{console.log("[usePlanExecution] Polling plan status for:",P);const U=await Nt.getDetails(P);if(console.log("[usePlanExecution] Received plan details:",U?"YES":"NO",U),r.delete(P),!U){const $=r.get(P)||0;$<10?(r.set(P,$+1),console.log(`[usePlanExecution] Plan ${P} not found yet, retrying (${$+1}/10)`),setTimeout(()=>{s.value.has(P)&&S(P).catch(I=>{console.error(`[usePlanExecution] Retry poll failed for ${P}:`,I)})},1e3)):(console.warn(`[usePlanExecution] Plan ${P} not found after 10 attempts, giving up`),m(P));return}const D=l.get(P)||0;l.set(P,D+1);const q=U.rootPlanId||U.currentPlanId;if(!q){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",U);return}if(d.set(q,U),P!==q&&(d.set(P,U),console.log("[usePlanExecution] Stored record with both keys:",{planId:P,recordKey:q})),console.log("[usePlanExecution] Updated plan execution record:",{planId:P,recordKey:q,rootPlanId:U.rootPlanId,currentPlanId:U.currentPlanId,completed:U.completed,status:U.status,attempt:D+1}),U.completed){console.log(`[usePlanExecution] Plan ${q} completed, checking for summary...`);const $=yt();$.currentTask&&$.currentTask.isRunning&&($.currentTask.isRunning=!1);const I=U.summary||U.result||U.message,T=a.get(q)||0;if(!I&&T<10)a.set(q,T+1),console.log(`[usePlanExecution] Plan ${q} completed but no summary yet, continuing to poll (${T+1}/10)`);else{console.log(`[usePlanExecution] Plan ${q} completed, cleaning up...`,{hasSummary:!!I,pollCount:T});try{await Nt.deleteExecutionDetails(q),console.log(`[usePlanExecution] Deleted execution details for plan: ${q}`)}catch(O){const J=O instanceof Error?O.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${J}`)}m(P),a.delete(q),setTimeout(()=>{d.delete(q),P!==q&&d.delete(P)},5e3)}}U.status==="failed"&&U.message&&!U.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${q} failed:`,U.message)}catch(U){const D=U instanceof Error?U.message:"Unknown error";console.error(`[usePlanExecution] Failed to poll plan status for ${P}:`,D);const q=r.get(P)||0;q<10&&(r.set(P,q+1),console.log(`[usePlanExecution] Network error for ${P}, retrying (${q+1}/10)`),setTimeout(()=>{s.value.has(P)&&S(P).catch($=>{console.error(`[usePlanExecution] Retry poll failed for ${P}:`,$)})},1e3*(q+1)))}},w=async()=>{if(y.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const P=new Set(s.value);for(const[U]of a.entries())P.add(U);if(P.size!==0)try{y.value=!0;const U=Array.from(P).map(D=>S(D));await Promise.all(U)}catch(U){console.error("[usePlanExecution] Failed to poll tracked plans:",U)}finally{y.value=!1}},v=()=>{u.value&&clearInterval(u.value),u.value=window.setInterval(()=>{w()},1e3),console.log("[usePlanExecution] Started adaptive polling")},N=()=>{if(a.size>0){console.log(`[usePlanExecution] Not stopping polling - ${a.size} completed plans still waiting for summary`);return}u.value&&(clearInterval(u.value),u.value=null),console.log("[usePlanExecution] Stopped polling")},W=async P=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${P}`),await S(P)},L=P=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:P}),!P){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}yt().setTaskRunning(P),E(P)},b=()=>{N(),s.value.clear(),a.clear(),l.clear(),r.clear(),d.clear(),y.value=!1};return{planExecutionRecords:Ne(d),trackedPlanIds:Ne(s),isPolling:Ne(y),getPlanExecutionRecord:i,setCachedPlanRecord:f,getTrackedPlanIds:k,trackPlan:E,untrackPlan:m,handlePlanExecutionRequested:L,pollPlanStatusImmediately:W,startPolling:v,stopPolling:N,cleanup:b}}let kt=null;function Ze(){return kt||(kt=Oa()),kt}function qa(){const n=Ze(),t=A([]),e=A(null),s=A(null),a=A(null),l=re(()=>a.value),r=A(!1),d=A(null),y=A(null),u=A(null),i=re(()=>e.value&&t.value.find(M=>M.id===e.value)||null),f=re(()=>t.value.length>0),k=re(()=>t.value.length),E=re(()=>{if(!s.value)return i.value?.messages||[];const M=[];for(const V of t.value)V.conversationId===s.value&&M.push(...V.messages);return M.sort((V,G)=>V.timestamp.getTime()-G.timestamp.getTime())}),m=M=>{const V={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:M||"New Conversation",messages:[],...s.value&&{conversationId:s.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(V),e.value=V.id,console.log("[useMessageDialog] Created new dialog round:",V.id,{conversationId:s.value,rootPlanId:a.value}),V},S=M=>t.value.find(V=>V.id===M)||null,w=M=>{if(t.value.forEach(V=>{V.isActive=!1}),M){const V=t.value.find(G=>G.id===M);V&&(V.isActive=!0,e.value=M)}else e.value=null},v=(M,V)=>{const G=t.value.find(Z=>Z.id===M);G&&(G.messages.push(V),G.updatedAt=new Date)},N=(M,V,G)=>{const Z=t.value.find(oe=>oe.id===M);if(Z){const oe=Z.messages.findIndex(ie=>ie.id===V);oe!==-1&&(Z.messages[oe]={...Z.messages[oe],...G},Z.updatedAt=new Date)}},W=M=>{const V=t.value.findIndex(G=>G.id===M);if(V!==-1){const G=t.value[V];if(t.value.splice(V,1),console.log("[useMessageDialog] Deleted dialog round:",M),e.value===M){const Z=t.value.filter(oe=>oe.conversationId===G.conversationId);e.value=Z.length>0?Z[0].id:null,e.value&&w(e.value)}}},L=M=>{const V=t.value.filter(G=>G.planId===M);V.forEach(G=>{W(G.id)}),console.log(`[useMessageDialog] Deleted ${V.length} dialog round(s) for plan:`,M)},b=M=>{const V=t.value.filter(G=>G.conversationId===M);V.forEach(G=>{W(G.id)}),console.log(`[useMessageDialog] Deleted ${V.length} dialog round(s) for conversation:`,M),s.value===M&&(s.value=null)},P=()=>{t.value=[],e.value=null},U=async M=>{let V=null,G=null;try{if(r.value){const he="Please wait for the current task to complete before starting a new one";return d.value=he,{success:!1,error:he}}r.value=!0,d.value=null,V=m();const Z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.input,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(he=>typeof he=="string"?new File([],he):he)}};v(V.id,Z),G={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},v(V.id,G);const oe=M;let ie;if(oe.toolName&&oe.replacementParams?ie=await Yt.executeByToolName(oe.toolName,oe.replacementParams,M.uploadedFiles,M.uploadKey,"VUE_DIALOG"):ie=await Yt.sendMessageWithDefaultPlan(M,"VUE_DIALOG"),ie.conversationId&&(s.value=ie.conversationId,V.conversationId=ie.conversationId,Ie.setConversationId(ie.conversationId),console.log("[useMessageDialog] Conversation ID set:",ie.conversationId)),ie.planId){const he=ie.planId;a.value=he,V.planId=he,N(V.id,G.id,{thinking:"Planning execution...",planExecution:{currentPlanId:he,rootPlanId:he,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(he),console.log("[useMessageDialog] Root plan ID set and tracking started:",he)}else{const he={content:ie.message||ie.result||"No response received",isStreaming:!1};N(V.id,G.id,he)}return{success:!0,...ie.planId&&{planId:ie.planId},...ie.conversationId&&{conversationId:ie.conversationId}}}catch(Z){const oe=Z instanceof Error?Z.message:"Failed to send message";return d.value=oe,console.error("[useMessageDialog] Send message failed:",Z),V&&G&&N(V.id,G.id,{content:`Error: ${oe}`,error:oe,isStreaming:!1}),{success:!1,error:oe}}finally{r.value=!1}},D=async M=>{let V=null,G=null;try{if(r.value){const te="Please wait for the current task to complete before starting a new one";return d.value=te,{success:!1,error:te}}r.value=!0,d.value=null;const Z=Ie.getConversationId();Z&&!s.value&&(s.value=Z,console.log("[useMessageDialog] Restored conversationId from memoryStore:",Z)),V=m(M.title),M.title&&(V.title=M.title);const oe={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.title,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(te=>typeof te=="string"?new File([],te):te)}};v(V.id,oe),G={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},v(V.id,G);const ie=M.planData.planTemplateId;if(!ie||ie===null)throw new Error("Plan template ID is required");const he=await go.executePlan(ie,M.params,M.uploadedFiles,M.replacementParams,M.uploadKey??void 0,"VUE_SIDEBAR");if(he.conversationId){const te=he.conversationId,j=s.value||Ie.getConversationId();te!==j?(console.log("[useMessageDialog] Conversation ID changed:",j,"->",te),s.value=te,V.conversationId=te,Ie.setConversationId(te)):(V.conversationId=te,console.log("[useMessageDialog] Conversation ID unchanged:",te))}else s.value&&(V.conversationId=s.value);if(he.planId){const te=he.planId;a.value=te,V.planId=te,N(V.id,G.id,{thinking:"Planning execution...",planExecution:{currentPlanId:te,rootPlanId:te,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(te),console.log("[useMessageDialog] Root plan ID set and tracking started:",te)}else{const te={content:"Plan execution started",isStreaming:!1};N(V.id,G.id,te)}return{success:!0,...he.planId&&{planId:he.planId}}}catch(Z){const oe=Z instanceof Error?Z.message:"Failed to execute plan";return d.value=oe,console.error("[useMessageDialog] Execute plan failed:",Z),V&&G&&N(V.id,G.id,{content:`Error: ${oe}`,error:oe,isStreaming:!1}),r.value=!1,{success:!1,error:oe}}},q=(M,V,G)=>{const Z={};G!==void 0&&(Z.planExecution=G),N(M,V,Z)},$=M=>{const V={...M};return"agentExecutionSequence"in M&&Array.isArray(M.agentExecutionSequence)&&(V.agentExecutionSequence=M.agentExecutionSequence.map(G=>I(G))),V},I=M=>{const V={...M};return"subPlanExecutionRecords"in M&&Array.isArray(M.subPlanExecutionRecords)&&(V.subPlanExecutionRecords=M.subPlanExecutionRecords.map(G=>$(G))),V},T=(M,V,G)=>{i.value||m();const Z=i.value,oe={...G};G?.planExecution&&(oe.planExecution=$(G.planExecution));const ie={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:M,content:V,timestamp:new Date,isStreaming:!1,...oe};return Z.messages.push(ie),Z.updatedAt=new Date,ie},O=(M,V)=>{if(!i.value)return;const G={...V};V.planExecution&&(G.planExecution=$(V.planExecution));const Z=i.value.messages.findIndex(oe=>oe.id===M);Z!==-1&&(i.value.messages[Z]={...i.value.messages[Z],...G},i.value.updatedAt=new Date)},J=M=>{if(i.value)return i.value.messages.find(V=>V.id===M)},H=M=>{y.value=M,O(M,{isStreaming:!0})},X=M=>{M&&O(M,{isStreaming:!1}),(y.value===M||!M)&&(y.value=null)},se=()=>{i.value&&(i.value.messages=[],i.value.updatedAt=new Date,y.value=null)},Y=(M,V)=>{r.value=!M,V!==void 0&&(u.value=V),console.log("[useMessageDialog] Input state updated:",{enabled:M,placeholder:V,isLoading:r.value})},ne=M=>{s.value=M,console.log("[useMessageDialog] Set conversationId:",M)},Pe=()=>{t.value=[],e.value=null,a.value=null,s.value=null,r.value=!1,d.value=null,u.value=null},de=(M,V,G)=>{const Z={planExecution:$(G),isStreaming:!G.completed};if(!G.completed)Z.thinking="Processing...";else{if(!G.agentExecutionSequence||G.agentExecutionSequence.length===0){const oe=G.summary??G.result??G.message??"Execution completed";oe&&(Z.content=oe,Z.thinking="")}else G.summary&&(Z.content=G.summary,Z.thinking="");G.status==="failed"&&G.message&&(Z.content=`Error: ${G.message}`,Z.thinking="")}N(M.id,V.id,Z)};return _s(()=>{const M=n.planExecutionRecords,V=M.size,G=Array.from(M.entries()),Z=t.value;console.log("[useMessageDialog] watchEffect triggered - records count:",G.length,"size:",V),console.log("[useMessageDialog] watchEffect - dialogList count:",Z.length),console.log("[useMessageDialog] watchEffect - dialogs with planId:",Z.filter(te=>te.planId).map(te=>({id:te.id,planId:te.planId})));for(const te of Z){if(!te.planId){console.log("[useMessageDialog] watchEffect: Skipping dialog without planId:",te.id);continue}const j=te.messages.find(ae=>ae.planExecution?.rootPlanId===te.planId||ae.planExecution?.currentPlanId===te.planId);if(!j){console.log("[useMessageDialog] watchEffect: No message found for planId:",te.planId,{dialogMessages:te.messages.map(ae=>({id:ae.id,type:ae.type,planExecutionRootPlanId:ae.planExecution?.rootPlanId,planExecutionCurrentPlanId:ae.planExecution?.currentPlanId,hasPlanExecution:!!ae.planExecution}))});continue}let R=G.find(([ae])=>ae===te.planId);const z=j.planExecution;if(!R&&z?.rootPlanId&&(R=G.find(([ae])=>ae===z.rootPlanId)),!R&&z?.currentPlanId&&(R=G.find(([ae])=>ae===z.currentPlanId)),!R){for(const[ae,_e]of G)if(_e&&(_e.rootPlanId===te.planId||_e.currentPlanId===te.planId||j.planExecution?.rootPlanId&&(_e.rootPlanId===j.planExecution.rootPlanId||_e.currentPlanId===j.planExecution.rootPlanId)||j.planExecution?.currentPlanId&&(_e.rootPlanId===j.planExecution.currentPlanId||_e.currentPlanId===j.planExecution.currentPlanId))){R=[ae,_e],console.log("[useMessageDialog] watchEffect: Found record by value matching:",{dialogPlanId:te.planId,recordKey:ae,recordRootPlanId:_e.rootPlanId,recordCurrentPlanId:_e.currentPlanId});break}}if(!R){const ae=j.planExecution;if(ae&&ae.status==="running"){console.log("[useMessageDialog] watchEffect: Message has planExecution but record not found yet, keeping initial state:",{dialogId:te.id,messageId:j.id,planId:te.planId,messagePlanExecution:ae,availableRecordKeys:G.map(([_e])=>_e)});continue}console.log("[useMessageDialog] watchEffect: No record found and message has no running planExecution:",{dialogId:te.id,planId:te.planId,hasPlanExecution:!!j.planExecution,planExecutionStatus:j.planExecution?.status,availableRecordKeys:G.map(([_e])=>_e)});continue}const[,ee]=R,le=$(ee);console.log("[useMessageDialog] watchEffect: Updating message with plan record:",{dialogId:te.id,messageId:j.id,planId:te.planId,recordKey:R[0],recordCompleted:le.completed,recordStatus:le.status}),de(te,j,le)}const oe=n.trackedPlanIds.value.size>0,ie=G.some(([,te])=>te&&!te.completed&&te.status!=="failed");!(oe||ie)&&r.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading",{hasTrackedPlans:oe,hasRunningPlansInRecords:ie,trackedPlanIds:Array.from(n.trackedPlanIds.value),recordsCount:G.length}),r.value=!1)}),{dialogList:Ne(t),activeDialogId:Ne(e),rootPlanId:Ne(a),conversationId:Ne(s),isLoading:r,error:d,streamingMessageId:Ne(y),inputPlaceholder:Ne(u),activeDialog:i,activeRootPlanId:l,hasDialogs:f,dialogCount:k,messages:E,createDialog:m,getDialog:S,setActiveDialog:w,addMessageToDialog:v,updateMessageInDialog:N,deleteDialog:W,deleteConversationRoundByPlanId:L,deleteConversation:b,clearAllDialogs:P,sendMessage:U,executePlan:D,updatePlanExecutionStatus:q,updateInputState:Y,setConversationId:ne,reset:Pe,addMessage:T,updateMessage:O,findMessage:J,startStreaming:H,stopStreaming:X,clearMessages:se}}let Ct=null;function et(){return Ct||(Ct=qa()),Ct}function Ba(n){const t=A(!1),e=A(!0),s=150,a=async(w=!0)=>{n.value&&(await xe(),n.value.scrollTo({top:n.value.scrollHeight,behavior:w?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:w,scrollHeight:v,clientHeight:N}=n.value;return v-w-N<s},r=()=>{if(!n.value)return;const w=l();t.value=!w&&n.value.scrollHeight>n.value.clientHeight,w&&(e.value=!0)},d=()=>{r(),l()||(e.value=!1)},y=async()=>{e.value&&await a()},u=async()=>{e.value=!0,await a()},i=(w,v=!0)=>{if(!n.value)return;const N=n.value.querySelector(`[data-message-id="${w}"]`);N&&N.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},f=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:w,scrollHeight:v,clientHeight:N}=n.value,W=w===0,L=w+N>=v-5,b=v>N?w/(v-N)*100:100;return{scrollTop:w,scrollHeight:v,clientHeight:N,isAtTop:W,isAtBottom:L,scrollPercentage:b}},k=()=>{n.value&&n.value.addEventListener("scroll",d,{passive:!0})},E=()=>{n.value&&n.value.removeEventListener("scroll",d)},m=()=>{k(),r()},S=()=>{E()};return Me(()=>{xe(()=>{m()})}),Ue(()=>{S()}),{showScrollToBottom:Ne(t),isAutoScrollEnabled:Ne(e),scrollToBottom:a,autoScrollToBottom:y,forceScrollToBottom:u,scrollToMessage:i,isNearBottom:l,checkScrollPosition:r,getScrollInfo:f,addScrollListener:k,removeScrollListener:E,initializeScrollBehavior:m,cleanupScrollBehavior:S}}const Ha={class:"chat-container"},Va=["data-message-id"],ja={class:"user-content"},za={class:"message-text"},Wa={key:0,class:"attachments"},Ga={class:"attachment-name"},Ka={class:"attachment-size"},Ja={class:"message-timestamp"},Xa={key:0,class:"message-status error"},Ya={class:"status-text"},Qa={key:1,class:"assistant-message"},Za={key:0,class:"loading-message"},el={class:"loading-content"},tl=["title"],sl=Ee({__name:"ChatContainer",emits:["step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=et(),{messages:l,isLoading:r,streamingMessageId:d,updateMessage:y,startStreaming:u,findMessage:i}=a,f=A(null),{scrollToBottom:k,autoScrollToBottom:E,showScrollToBottom:m}=Ba(f),{getMessageClasses:S,formatTimestamp:w,formatFileSize:v}=Ts(),N=$=>d.value===$,W=re(()=>l.value),L=$=>{const I=$.target;if(I.classList.contains("md-copy-btn")){const T=I.getAttribute("data-raw");if(T){const O=decodeURIComponent(T);navigator.clipboard.writeText(O).then(()=>{I.textContent=s("chat.copied"),setTimeout(()=>{I.textContent=s("chat.copy")},1e3)})}}},b=async $=>{const I=i($);if(I)try{const T=I.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(T)}catch(T){console.error("Failed to copy message:",T)}},P=$=>{const I=i($);I&&I.type==="assistant"&&(y($,{content:""}),u($),console.warn("[ChatContainer] Regenerate not yet implemented"))},U=$=>{i($)&&(y($,{content:""}),u($),console.warn("[ChatContainer] Retry not yet implemented"))},D=$=>{console.log("[ChatContainer] Step selected:",$),e("step-selected",$)},q=($,I)=>{console.log("[ChatContainer] User input submitted:",I,"for message:",$.id),console.warn("[ChatContainer] User input submission not yet implemented")};return Me(()=>{be(l,()=>{xe(()=>{E()})},{deep:!0})}),Ue(()=>{}),($,I)=>(h(),g("div",Ha,[o("div",{class:"messages",ref_key:"messagesRef",ref:f,onClick:L},[(h(!0),g(fe,null,ye(W.value,T=>(h(),g("div",{key:T.id,class:ge(["chat-message",[p(S)(T),{streaming:N(T.id)}]])},[T.type==="user"?(h(),g("div",{key:0,class:"user-message","data-message-id":T.id},[o("div",ja,[o("div",za,c(T.content),1),T.attachments?.length?(h(),g("div",Wa,[(h(!0),g(fe,null,ye(T.attachments,(O,J)=>(h(),g("div",{key:J,class:"attachment-item"},[x(p(F),{icon:"carbon:document",class:"attachment-icon"}),o("span",Ga,c(O.name),1),o("span",Ka,c(p(v)(O.size)),1)]))),128))])):B("",!0),o("div",Ja,c(p(w)(T.timestamp)),1)]),T.error?(h(),g("div",Xa,[x(p(F),{icon:"carbon:warning",class:"status-icon"}),o("span",Ya,c(T.error),1)])):B("",!0)],8,Va)):T.type==="assistant"?(h(),g("div",Qa,[T.planExecution?(h(),Se(zn,{key:0,"plan-execution":T.planExecution,"step-actions":T.stepActions||[],"generic-input":T.genericInput||"",onStepSelected:D},null,8,["plan-execution","step-actions","generic-input"])):B("",!0),T.content||T.error||N(T.id)||T.planExecution?.userInputWaitState?.waiting?(h(),Se(La,bs({key:1,content:T.content||"","is-streaming":N(T.id)||!1},{ref_for:!0},{...T.error?{error:T.error}:{},...T.planExecution?.userInputWaitState?{userInputWaitState:T.planExecution.userInputWaitState}:{},...T.planExecution?.currentPlanId?{planId:T.planExecution.currentPlanId}:{}},{timestamp:T.timestamp,"generic-input":T.genericInput||"",onCopy:()=>b(T.id),onRegenerate:()=>P(T.id),onRetry:()=>U(T.id),onUserInputSubmitted:O=>q(T,O)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):B("",!0)])):B("",!0)],2))),128)),p(r)?(h(),g("div",Za,[o("div",el,[x(p(F),{icon:"carbon:circle-dash",class:"loading-icon"}),o("span",null,c($.$t("chat.processing")),1)])])):B("",!0)],512),x(_t,{name:"scroll-button"},{default:ze(()=>[p(m)?(h(),g("button",{key:0,class:"scroll-to-bottom",onClick:I[0]||(I[0]=()=>p(k)()),title:$.$t("chat.scrollToBottom")},[x(p(F),{icon:"carbon:chevron-down"})],8,tl)):B("",!0)]),_:1})]))}}),ol=ke(sl,[["__scopeId","data-v-b590114c"]]);class Zt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const nl={class:"file-upload-component"},al=["accept"],ll={key:0},rl={key:1},il={key:0,class:"files-list"},cl={class:"file-name"},ul={class:"file-size"},dl=["onClick","title"],pl={key:0,class:"upload-progress"},ml=Ee({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.mhtml,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=n,l=e,r=A(),d=A([]),y=A(!1),u=A(null),i=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),d.value=[],u.value=null,l("upload-key-changed",null)};Ue(()=>{i()}),be(()=>d.value,w=>{l("files-removed",w)},{deep:!0});const f=()=>{a.disabled||r.value&&r.value.click()},k=async w=>{const v=w.target,N=v.files;if(!N||N.length===0)return;const W=Array.from(N);console.log("[FileUpload] Selected files for upload:",W.map(L=>L.name)),await E(W),v.value=""},E=async w=>{if(w.length!==0){y.value=!0,l("upload-started");try{const v=await Zt.uploadFiles(w);v.success&&(!u.value&&v.uploadKey?(u.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",u.value),d.value=v.uploadedFiles):u.value?(console.log("[FileUpload] Using existing uploadKey:",u.value),d.value=[...d.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),d.value=v.uploadedFiles),v.uploadKey&&(u.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",u.value)),console.log("[Input] Updated global uploadedFiles state:",d.value),l("files-uploaded",d.value,u.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{y.value=!1}}},m=async w=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",w.originalName,"from uploadKey:",u),u.value){const v=await Zt.deleteFile(u.value,w.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}d.value=d.value.filter(v=>v.originalName!==w.originalName),d.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),u.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",d.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},S=w=>{if(w===0)return"0 Bytes";const v=1024,N=["Bytes","KB","MB","GB"],W=Math.floor(Math.log(w)/Math.log(v));return parseFloat((w/Math.pow(v,W)).toFixed(2))+" "+N[W]};return t({uploadedFiles:d,uploadKey:u,resetSession:i,uploadFiles:E,removeFile:m,isUploading:y}),(w,v)=>(h(),g("div",nl,[o("input",{ref_key:"fileInputRef",ref:r,type:"file",multiple:"",style:{display:"none"},onChange:k,accept:w.acceptedFileTypes||""},null,40,al),o("div",{class:ge(["uploaded-files",{"has-files":d.value.length>0}])},[o("div",{class:"files-header",onClick:f},[x(p(F),{icon:"carbon:attachment"}),d.value.length===0?(h(),g("span",ll,c(p(s)("input.attachFile")),1)):(h(),g("span",rl,c(p(s)("input.attachedFiles"))+" ("+c(d.value.length)+")",1))]),d.value.length>0?(h(),g("div",il,[(h(!0),g(fe,null,ye(d.value,N=>(h(),g("div",{key:N.originalName,class:"file-item"},[x(p(F),{icon:"carbon:document",class:"file-icon"}),o("span",cl,c(N.originalName),1),o("span",ul,"("+c(S(N.size))+")",1),o("button",{onClick:W=>m(N),class:"remove-btn",title:p(s)("input.removeFile")},[x(p(F),{icon:"carbon:close"})],8,dl)]))),128))])):B("",!0)],2),y.value?(h(),g("div",pl,[x(p(F),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),o("span",null,c(p(s)("input.uploading")),1)])):B("",!0)]))}}),Es=ke(ml,[["__scopeId","data-v-866ef77f"]]),hl={class:"input-area"},fl={class:"input-container"},vl={class:"input-row-first"},gl=["placeholder","disabled"],yl={class:"input-row-second"},bl=["title","disabled"],_l={value:""},wl=["value"],$l=["disabled","title"],Sl=["title"],es="chatInputHistory",ts=20,Pl=Ee({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},setup(n,{expose:t}){const{t:e}=De(),s=yt(),a=Ge(),l=et(),r=Ze(),d=re(()=>s.hasRunningTask()),y=n,u=A(),i=A(),f=A(""),k=re(()=>e("input.placeholder")),E=A(null),m=re(()=>l.inputPlaceholder.value?l.inputPlaceholder.value:E.value?E.value:k.value),S=A([]),w=A(null),v=A(""),N=A([]),W=A(!1),L=A(!1),b=A([]),P=A(-1),U=A(""),D=re(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),q=async()=>{W.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const R=a.getAllCoordinatorToolsFromTemplates(),z=[];for(const le of R)if(le.enableInternalToolcall)try{const ae=JSON.parse(le.inputSchema||"[]");if(Array.isArray(ae)&&ae.length===1){const _e=ae[0];z.push({value:le.planTemplateId,label:`${le.toolName} (${_e.name})`,toolName:le.toolName,planTemplateId:le.planTemplateId,paramName:_e.name})}}catch(ae){console.warn("[InputArea] Failed to parse inputSchema for tool:",le.toolName,ae)}N.value=z,console.log("[InputArea] Loaded",z.length,"inner tools with single parameter");const ee=localStorage.getItem("inputAreaSelectedTool");if(ee){if(z.length>0)if(z.some(ae=>ae.value===ee)){L.value=!0;try{v.value=ee,console.log("[InputArea] Restored selected tool from localStorage:",ee)}finally{L.value=!1}}else console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),v.value===ee&&(v.value="");else if(v.value!==ee){L.value=!0;try{v.value=ee,console.log("[InputArea] Restored selected tool from localStorage (tools not loaded yet):",ee)}finally{L.value=!1}}}}catch(R){console.error("[InputArea] Failed to load inner tools:",R),N.value=[]}finally{W.value=!1}},$=re(()=>N.value.length>0?N.value.map(R=>({value:R.value,label:R.label})):y.selectionOptions);be(v,R=>{L.value||localStorage.setItem("inputAreaSelectedTool",R||"")});const I=()=>{try{const R=localStorage.getItem(es);R&&(b.value=JSON.parse(R))}catch(R){console.error("[InputArea] Failed to load history:",R),b.value=[]}},T=()=>{try{localStorage.setItem(es,JSON.stringify(b.value))}catch(R){console.error("[InputArea] Failed to save history:",R)}},O=R=>{if(!R.trim())return;const z=b.value.indexOf(R);z!==-1&&b.value.splice(z,1),b.value.unshift(R),b.value.length>ts&&(b.value=b.value.slice(0,ts)),T()},J=R=>{if(b.value.length===0)return;P.value===-1&&(U.value=f.value);let z=P.value+R;z<-1?z=-1:z>=b.value.length&&(z=b.value.length-1),P.value=z,P.value===-1?(f.value=U.value,U.value=""):f.value=b.value[P.value],V()};be(()=>a.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),q()},{deep:!0}),Me(()=>{q(),I(),be(()=>r.planExecutionRecords,R=>{const z=Array.from(R.entries());if(z.length===0)return;z.some(([,le])=>le&&!le.completed&&le.status!=="failed")||(console.log("[InputArea] All plans completed, resetting session"),H())},{deep:!0}),be(()=>s.taskToInput,R=>{R?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",R),xe(()=>{te(R.trim()),s.getAndClearTaskToInput()}))},{immediate:!1})});const H=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),i.value?.resetSession()};Ue(()=>{H()});const X=(R,z)=>{S.value=R.map(ee=>ee.originalName),w.value=z,console.log("[InputArea] Files uploaded:",R.length,"uploadKey:",z),S.value.length>0&&(E.value=e("input.filesAttached",{count:S.value.length}))},se=R=>{S.value=R.map(z=>z.originalName),console.log("[InputArea] Files removed, remaining:",R.length),S.value.length===0?E.value=null:E.value=e("input.filesAttached",{count:S.value.length})},Y=R=>{w.value=R,console.log("[InputArea] Upload key changed:",R)},ne=()=>{console.log("[InputArea] Upload started")},Pe=()=>{console.log("[InputArea] Upload completed")},de=R=>{console.error("[InputArea] Upload error:",R)},M=re(()=>l.isLoading.value),V=()=>{xe(()=>{u.value&&(u.value.style.height="auto",u.value.style.height=Math.min(u.value.scrollHeight,120)+"px")})},G=R=>{if(R.key==="Enter"&&(R.ctrlKey||R.metaKey)){R.preventDefault(),Z();return}const z=D.value?R.altKey:R.ctrlKey;if(R.key==="ArrowUp"&&z){R.preventDefault(),J(1);return}if(R.key==="ArrowDown"&&z){R.preventDefault(),J(-1);return}P.value!==-1&&R.key.length===1&&!R.ctrlKey&&!R.metaKey&&!R.altKey&&(P.value=-1,U.value="")},Z=async()=>{if(!f.value.trim()||M.value)return;const R=f.value.trim();O(R),P.value=-1,U.value="";const z={input:R,memoryId:Ie.selectMemoryId,uploadedFiles:S.value};if(w.value?(z.uploadKey=w.value,console.log("[InputArea] Including uploadKey in message:",w.value)):console.log("[InputArea] No uploadKey available for message"),v.value){const ee=N.value.find(le=>le.value===v.value);if(ee){const le=z;le.toolName=ee.planTemplateId,le.replacementParams={[ee.paramName]:R},console.log("[InputArea] Sending message with tool:",ee.toolName)}}try{await l.sendMessage(z)}catch(ee){const le=ee instanceof Error?ee.message:String(ee);console.error("[InputArea] Send message failed:",le)}ie()},oe=async()=>{console.log("[InputArea] Stop button clicked"),await s.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},ie=()=>{f.value="",V()},he=(R,z)=>{l.updateInputState(R,z)},te=R=>{f.value=R,V()},j=()=>f.value.trim();return be(()=>y.initialValue,R=>{R.trim()&&(f.value=R,V())},{immediate:!0}),t({clearInput:ie,updateState:he,getQuery:j,focus:()=>u.value?.focus(),get uploadedFiles(){return i.value?.uploadedFiles?.map(R=>R.originalName)||[]},get uploadKey(){return i.value?.uploadKey||null}}),(R,z)=>(h(),g("div",hl,[x(Es,{ref_key:"fileUploadRef",ref:i,disabled:M.value,onFilesUploaded:X,onFilesRemoved:se,onUploadKeyChanged:Y,onUploadStarted:ne,onUploadCompleted:Pe,onUploadError:de},null,8,["disabled"]),o("div",fl,[o("div",vl,[we(o("textarea",{"onUpdate:modelValue":z[0]||(z[0]=ee=>f.value=ee),ref_key:"inputRef",ref:u,class:"chat-input",placeholder:m.value,disabled:M.value,onKeydown:G,onInput:V},null,40,gl),[[Ce,f.value]])]),o("div",yl,[we(o("select",{"onUpdate:modelValue":z[1]||(z[1]=ee=>v.value=ee),class:"selection-input",title:R.$t("input.selectionTitle"),disabled:W.value||M.value},[o("option",_l,c(R.$t("input.defaultFuncAgent")),1),(h(!0),g(fe,null,ye($.value,ee=>(h(),g("option",{key:ee.value,value:ee.value},c(ee.label),9,wl))),128))],8,bl),[[Bt,v.value]]),d.value?(h(),g("button",{key:1,class:"send-button stop-button",onClick:oe,title:R.$t("input.stop")},[x(p(F),{icon:"carbon:stop-filled"}),me(" "+c(R.$t("input.stop")),1)],8,Sl)):(h(),g("button",{key:0,class:"send-button",disabled:!f.value.trim()||M.value,onClick:Z,title:R.$t("input.send")},[x(p(F),{icon:"carbon:send-alt"}),me(" "+c(R.$t("input.send")),1)],8,$l))])])]))}}),Tl=ke(Pl,[["__scopeId","data-v-63823e52"]]);class ht{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const El={key:0,class:"app-container"},kl={class:"app-content"},Cl={class:"header"},Il={class:"relative"},Rl={class:"title-edit-group"},xl={id:"main-title",class:"main-title"},Al={key:0,id:"title-edit-container",class:"title-edit-container"},Fl={class:"search-bar"},Ml={class:"search-container"},Dl=["placeholder"],Nl={class:"message-list",id:"message-list"},Ul={class:"message-header"},Ll={class:"message-content"},Ol={class:"sender-info"},ql=["onClick"],Bl={class:"sender-name"},Hl={class:"action-buttons"},Vl=["onClick"],jl={class:"action-buttons"},zl=["onClick"],Wl={class:"message-meta"},Gl={class:"message-id"},Kl={class:"meta-right"},Jl={key:0,class:"unread-count"},Xl={class:"message-time"},Yl=["id"],Ql={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Zl={class:"bubble-avatar"},er={class:"bubble-content"},tr={class:"bubble-text"},sr={key:0,class:"empty-state"},or={class:"modal-content"},nr={class:"modal-header"},ar={class:"modal-title"},lr=["placeholder"],rr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},ir={class:"modal-footer"},cr={class:"modal-content"},ur={class:"modal-header"},dr={class:"modal-title"},pr={class:"state-text",id:"delete-message"},mr={class:"modal-footer"},hr=Ee({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(n,{emit:t}){const e=A(!1),s=A(""),a=A([]),l=A([]),r=A(!1),d=A(null),y=A(""),u=A(!1),i=A(null),f=new Map,k=t,E=D=>{D.key==="Escape"&&(u.value?P():r.value&&N())};Me(()=>{Ie.setLoadMessages(m),document.addEventListener("keydown",E)}),Ue(()=>{document.removeEventListener("keydown",E)});const m=async()=>{try{const D=await ht.getMemories();a.value=D.map(q=>({...q,expanded:f.has(q.conversation_id)?f.get(q.conversation_id):!1})),l.value=[...a.value],v()}catch(D){console.error("error:",D),a.value=[],l.value=[]}},S=D=>{Ie.selectMemory(D),k("memory-selected")},w=D=>{const q=typeof D=="string"?parseInt(D,10):D;return isNaN(q)||q<=0?"--":new Date(q.toString().length===13?q:q*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const D=s.value.toLowerCase().trim();if(!D){l.value=[...a.value];return}l.value=a.value.filter(q=>{const $=q.memory_name.toLowerCase().includes(D),I=q.conversation_id.toLowerCase().includes(D),T=q.messages?.some(O=>O.text.toLowerCase().includes(D))??!1;return $||I||T})},N=()=>{r.value=!1,d.value=null},W=async()=>{if(!d.value)return;const D=y.value.trim()||"unknow name",q=a.value.findIndex($=>$.conversation_id===d.value);if(q!==-1){const $=a.value[q];try{const I=await ht.updateMemory($.conversation_id,D);I.messages||(I.messages=[]),a.value[q]={...I,expanded:$.expanded},v(),r.value=!1}catch(I){console.error("error:",I)}}},L=D=>{const q=a.value.find($=>$.conversation_id===D);if(q){q.expanded=!q.expanded,f.set(D,q.expanded);const $=l.value.findIndex(I=>I.conversation_id===D);$!==-1&&(l.value[$]={...q})}},b=D=>{i.value=D,u.value=!0},P=()=>{u.value=!1,i.value=null},U=async()=>{if(i.value)try{await ht.deleteMemory(i.value),a.value=a.value.filter(D=>D.conversation_id!==i.value),v(),a.value.length===0&&Ie.clearMemoryId(),u.value=!1,i.value=null}catch(D){console.error("error:",D)}};return(D,q)=>(h(),Se(ws,{to:"body"},[x(_t,{name:"modal"},{default:ze(()=>[p(Ie).isCollapsed?(h(),g("div",El,[o("div",kl,[o("div",Cl,[o("div",Il,[o("div",Rl,[o("h1",xl,[o("span",null,c(D.$t("memory.title")),1)])]),e.value?(h(),g("div",Al)):B("",!0)]),o("button",{class:"close-btn",onClick:q[0]||(q[0]=$=>p(Ie).toggleSidebar())},[x(p(F),{icon:"carbon:close"})])]),o("div",Fl,[o("div",Ml,[x(p(F),{class:"search-container-icon",icon:"carbon:search"}),we(o("input",{type:"text",placeholder:D.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":q[1]||(q[1]=$=>s.value=$),onInput:v},null,40,Dl),[[Ce,s.value]])])]),o("div",Nl,[o("div",null,[(h(!0),g(fe,null,ye(l.value,$=>(h(),g("div",{class:ge(["message-item",{expanded:$.expanded}]),key:$.conversation_id},[o("div",Ul,[o("div",Ll,[o("div",Ol,[o("div",{class:"sender-div",onClick:$e(I=>S($.conversation_id),["stop"])},[o("h3",Bl,c($.memory_name),1)],8,ql),o("div",Hl,[o("button",{class:"delete-btn",onClick:$e(I=>L($.conversation_id),["stop"])},[x(p(F),{id:"toggle-"+$.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Vl)]),o("div",jl,[o("button",{class:"delete-btn",onClick:$e(I=>b($.conversation_id),["stop"])},[x(p(F),{icon:"carbon:delete"})],8,zl)])]),o("div",Wl,[o("span",Gl,"ID: "+c($.conversation_id),1),o("div",Kl,[$.messages&&$.messages.length>0?(h(),g("span",Jl,c($.messages.length)+" "+c(D.$t("memory.size")),1)):B("",!0),o("span",Xl,c(w($.create_time)),1)])])])]),$.expanded?(h(),g("div",{key:0,id:"content-"+$.conversation_id,class:"expanded-content"},[o("div",Ql,[(h(!0),g(fe,null,ye($.messages,(I,T)=>(h(),g("div",{class:"message-bubble",key:T},[o("div",Zl,c(I.messageType),1),o("div",er,[o("p",tr,c(I.text),1)])]))),128))])],8,Yl)):B("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),g("div",sr,q[3]||(q[3]=[o("p",{class:"state-text"},"none message",-1)]))):B("",!0)]),r.value?(h(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:$e(N,["self"])},[o("div",or,[o("div",nr,[o("h3",ar,c(D.$t("memory.changeName")),1),we(o("input",{type:"text","onUpdate:modelValue":q[2]||(q[2]=$=>y.value=$),class:"edit-input",placeholder:D.$t("memory.newNamePlaceholder")},null,8,lr),[[Ce,y.value]]),o("span",rr,c(y.value.length),1)]),o("div",ir,[o("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:N},c(D.$t("memory.cancel")),1),o("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:W},c(D.$t("memory.save")),1)])])])):B("",!0),u.value?(h(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:$e(P,["self"])},[o("div",cr,[o("div",ur,[o("h3",dr,c(D.$t("memory.deleteHint")),1),o("p",pr,c(D.$t("memory.deleteHintPrefix"))+" "+c(i.value)+" "+c(D.$t("memory.deleteHintSuffix")),1)]),o("div",mr,[o("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:P},c(D.$t("memory.cancel")),1),o("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:U},c(D.$t("memory.delete")),1)])])])):B("",!0)])])):B("",!0)]),_:1})]))}}),fr=ke(hr,[["__scopeId","data-v-16358835"]]);class Xe{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),r=window.URL.createObjectURL(l),d=document.createElement("a");d.href=r,d.download=s??e.split("/").pop()??"download",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(r),document.body.removeChild(d)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(r=>t.startsWith(r)))return!0;const l=e.toLowerCase();return a.some(r=>l.endsWith(r))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const vr={class:"file-tree-node"},gr={class:"node-icon"},yr={class:"node-name"},br={key:1,class:"file-size"},_r={key:2,class:"node-actions"},wr={key:0,class:"children"},$r=Ee({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:t}){const e=n,s=t,a=A(e.level===0),l=A(!1),r=A(!1),d=A({}),y=()=>{e.node.type==="directory"&&(a.value=!a.value)},u=()=>{e.node.type==="directory"?y():i()},i=()=>{e.node.type==="file"&&s("file-selected",e.node),E()},f=()=>{s("download-file",e.node),E()},k=v=>{v.preventDefault(),r.value=!0,d.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",E)},0)},E=()=>{r.value=!1,document.removeEventListener("click",E)},m=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(v){console.error("Failed to copy path:",v)}E()},S=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Xe.getFileIcon(e.node),w=v=>{if(v===0)return"0 B";const N=1024,W=["B","KB","MB","GB"],L=Math.floor(Math.log(v)/Math.log(N));return parseFloat((v/Math.pow(N,L)).toFixed(1))+" "+W[L]};return Ue(()=>{document.removeEventListener("click",E)}),(v,N)=>{const W=ys("FileTreeNode",!0);return h(),g("div",vr,[o("div",{class:ge(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:Ye({paddingLeft:`${v.level*16+12}px`}),onClick:u,onContextmenu:$e(k,["prevent"])},[v.node.type==="directory"?(h(),g("div",{key:0,class:"expand-icon",onClick:$e(y,["stop"])},[x(p(F),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):B("",!0),o("div",gr,[x(p(F),{icon:S()},null,8,["icon"])]),o("span",yr,c(v.node.name),1),v.node.type==="file"?(h(),g("span",br,c(w(v.node.size)),1)):B("",!0),l.value?(h(),g("div",_r,[v.node.type==="file"?(h(),g("button",{key:0,onClick:N[0]||(N[0]=$e(L=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[x(p(F),{icon:"carbon:download"})])):B("",!0)])):B("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(h(),g("div",wr,[(h(!0),g(fe,null,ye(v.node.children,L=>(h(),Se(W,{key:L.path,node:L,level:v.level+1,onFileSelected:N[1]||(N[1]=b=>v.$emit("file-selected",b)),onDownloadFile:N[2]||(N[2]=b=>v.$emit("download-file",b))},null,8,["node","level"]))),128))])):B("",!0),r.value?(h(),g("div",{key:1,class:"context-menu",style:Ye(d.value),onClick:N[3]||(N[3]=$e(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:i},[x(p(F),{icon:"carbon:view"}),N[4]||(N[4]=o("span",null,"Open",-1))]),v.node.type==="file"?(h(),g("div",{key:0,class:"context-menu-item",onClick:f},[x(p(F),{icon:"carbon:download"}),N[5]||(N[5]=o("span",null,"Download",-1))])):B("",!0),N[7]||(N[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:m},[x(p(F),{icon:"carbon:copy"}),N[6]||(N[6]=o("span",null,"Copy Path",-1))])],4)):B("",!0)])}}}),Sr=ke($r,[["__scopeId","data-v-3fc455d1"]]),Pr={class:"file-browser"},Tr={class:"file-browser-header"},Er={class:"header-actions"},kr=["disabled","title"],Cr={class:"file-browser-content"},Ir={class:"file-tree-panel"},Rr={key:0,class:"loading-state"},xr={key:1,class:"error-state"},Ar={key:0,class:"waiting-for-files"},Fr={class:"message-content"},Mr={class:"tips"},Dr=["disabled"],Nr={key:1,class:"actual-error"},Ur={key:2,class:"empty-state"},Lr={key:3,class:"file-tree"},Or={key:0,class:"file-content-panel"},qr={class:"file-content-header"},Br={class:"file-info"},Hr={class:"file-name"},Vr={class:"file-size"},jr={class:"file-actions"},zr=["title"],Wr=["title"],Gr={class:"file-content-body"},Kr={key:0,class:"loading-content"},Jr={key:1,class:"content-error"},Xr={key:2,class:"file-content"},Yr={key:0,class:"text-content"},Qr={key:1,class:"binary-content"},Zr=Ee({name:"FileBrowser",__name:"index",props:{planId:{}},setup(n){const t=n,{t:e}=De(),s=A(!1),a=A(null),l=A(null),r=A(null),d=A(null),y=A(!1),u=A(null),i=A(null),f=re(()=>!d.value||!r.value?!1:Xe.isTextFile(d.value.mimeType,r.value.name)),k=re(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),E=()=>{i.value&&(clearTimeout(i.value),i.value=null)},m=()=>{E(),i.value=window.setTimeout(()=>{k.value&&S()},5e3)},S=async()=>{if(t.planId){s.value=!0,a.value=null,E();try{l.value=await Xe.getFileTree(t.planId)}catch(b){a.value=b instanceof Error?b.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",b);const P=b instanceof Error?b.message:"";(P.includes("Plan directory not found")||P.includes("not found"))&&m()}finally{s.value=!1}}},w=async b=>{if(b.type!=="directory"){r.value=b,d.value=null,y.value=!0,u.value=null;try{d.value=await Xe.getFileContent(t.planId,b.path)}catch(P){u.value=P instanceof Error?P.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",P)}finally{y.value=!1}}},v=async b=>{try{await Xe.downloadFile(t.planId,b.path,b.name)}catch(P){console.error("Failed to download file:",P)}},N=()=>{r.value=null,d.value=null,u.value=null},W=b=>Xe.getFileIcon(b),L=b=>{if(b===0)return"0 B";const P=1024,U=["B","KB","MB","GB"],D=Math.floor(Math.log(b)/Math.log(P));return parseFloat((b/Math.pow(P,D)).toFixed(1))+" "+U[D]};return be(()=>t.planId,b=>{b&&(r.value=null,d.value=null,S())},{immediate:!0}),Me(()=>{t.planId&&S()}),Ue(()=>{E()}),(b,P)=>(h(),g("div",Pr,[o("div",Tr,[o("h3",null,c(b.$t("fileBrowser.title")),1),o("div",Er,[o("button",{class:"refresh-btn",onClick:S,disabled:s.value,title:b.$t("fileBrowser.refresh")},[x(p(F),{icon:"carbon:refresh",class:ge({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,kr)])]),o("div",Cr,[o("div",Ir,[s.value?(h(),g("div",Rr,[x(p(F),{icon:"carbon:loading",class:"rotating"}),o("span",null,c(b.$t("fileBrowser.loading")),1)])):a.value?(h(),g("div",xr,[k.value?(h(),g("div",Ar,[x(p(F),{icon:"carbon:time",class:"rotating"}),o("div",Fr,[o("h3",null,c(b.$t("fileBrowser.waitingForGeneration")),1),o("p",null,c(b.$t("fileBrowser.planExecuting")),1),o("div",Mr,[x(p(F),{icon:"carbon:information"}),o("span",null,c(b.$t("fileBrowser.filesTip")),1)])]),o("button",{onClick:S,class:"retry-btn",disabled:s.value},[x(p(F),{icon:"carbon:refresh",class:ge({rotating:s.value})},null,8,["class"]),me(" "+c(s.value?b.$t("fileBrowser.checking"):b.$t("fileBrowser.checkNow")),1)],8,Dr)])):(h(),g("div",Nr,[x(p(F),{icon:"carbon:warning"}),o("span",null,c(a.value),1),o("button",{onClick:S,class:"retry-btn"},c(b.$t("fileBrowser.retry")),1)]))])):l.value?(h(),g("div",Lr,[x(Sr,{node:l.value,level:0,onFileSelected:w,onDownloadFile:v},null,8,["node"])])):(h(),g("div",Ur,[x(p(F),{icon:"carbon:folder-off"}),o("span",null,c(b.$t("fileBrowser.noFiles")),1)]))]),r.value?(h(),g("div",Or,[o("div",qr,[o("div",Br,[x(p(F),{icon:W(r.value)},null,8,["icon"]),o("span",Hr,c(r.value.name),1),o("span",Vr,"("+c(L(r.value.size))+")",1)]),o("div",jr,[o("button",{onClick:P[0]||(P[0]=U=>v(r.value)),class:"download-btn",title:b.$t("fileBrowser.download")},[x(p(F),{icon:"carbon:download"})],8,zr),o("button",{onClick:N,class:"close-btn",title:b.$t("common.close")},[x(p(F),{icon:"carbon:close"})],8,Wr)])]),o("div",Gr,[y.value?(h(),g("div",Kr,[x(p(F),{icon:"carbon:loading",class:"rotating"}),o("span",null,c(b.$t("fileBrowser.loadingContent")),1)])):u.value?(h(),g("div",Jr,[x(p(F),{icon:"carbon:warning"}),o("span",null,c(u.value),1)])):d.value?(h(),g("div",Xr,[f.value?(h(),g("div",Yr,[o("pre",null,[o("code",null,c(d.value.content),1)])])):(h(),g("div",Qr,[x(p(F),{icon:"carbon:document-unknown"}),o("p",null,c(b.$t("fileBrowser.binaryFile")),1),o("button",{onClick:P[1]||(P[1]=U=>v(r.value)),class:"download-btn-large"},[x(p(F),{icon:"carbon:download"}),me(" "+c(b.$t("fileBrowser.downloadToView")),1)])]))])):B("",!0)])])):B("",!0)])]))}}),ei=ke(Zr,[["__scopeId","data-v-a19b1e5b"]]);class ks{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}class Cs{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function ti(){const n=A([]),t=A(!1),e=A(null);return{availableTools:n,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await Cs.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),n.value=l.filter(r=>r.selectable!==!1).map(r=>({key:r.key||"",name:r.name||"",description:r.description||"",enabled:r.enabled||!1,serviceGroup:r.serviceGroup||"default",selectable:r.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",n.value=[]}finally{t.value=!1}}},reset:()=>{n.value=[],t.value=!1,e.value=null}}}let It=null;function at(){return It||(It=ti()),It}const si={class:"modal-form wide-modal"},oi={class:"form-section"},ni={class:"form-item"},ai=["placeholder"],li={class:"field-description"},ri={class:"form-section"},ii={class:"section-title"},ci={key:0,class:"params-help-text"},ui={class:"parameter-table"},di=["onUpdate:modelValue","placeholder","readonly"],pi=["onUpdate:modelValue","placeholder"],mi={class:"form-section"},hi={class:"service-publish-options"},fi={class:"internal-toolcall-publish-option"},vi={class:"checkbox-label"},gi={class:"checkbox-text"},yi={class:"checkbox-description"},bi={class:"http-publish-option"},_i={class:"checkbox-label"},wi={class:"checkbox-text"},$i={class:"checkbox-description"},Si={class:"button-container"},Pi=["disabled"],Ti=["disabled"],Ei=Ee({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=Ge(),l=at(),r=n,d=e,y=re({get:()=>r.modelValue,set:T=>d("update:modelValue",T)}),u=A(""),i=A(""),f=A(!1),k=A(!1),E=A(!1),m=A(!0),S=A({parameters:[],hasParameters:!1,requirements:""}),w=A(!1),v=He({userRequest:"",parameters:[]}),N=re(()=>{const T=!!a.selectedTemplate.value?.toolConfig;return s(T?"mcpService.updateService":"mcpService.createService")}),W=re(()=>!!a.selectedTemplate.value?.toolConfig),L=()=>{const T=a.selectedTemplate.value?.toolConfig;T?(v.userRequest=T.toolDescription||"",E.value=T.enableHttpService??!1,m.value=T.enableInternalToolcall??!0,T.inputSchema&&Array.isArray(T.inputSchema)&&T.inputSchema.length>0?v.parameters=T.inputSchema.map(O=>({name:O.name||"",description:O.description||""})):S.value.hasParameters||(v.parameters=[])):(v.userRequest="",E.value=!1,m.value=!0,S.value.hasParameters||(v.parameters=[]))},b=async()=>{const T=a.currentPlanTemplateId.value;if(!T){S.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[];return}w.value=!0;try{const O=await ks.getParameterRequirements(T);if(S.value=O,console.log("[PublishModal] Parameter requirements loaded:",O),O.hasParameters){const J=new Map;v.parameters.forEach(H=>{H.name&&J.set(H.name,H.description||"")}),v.parameters=O.parameters.map(H=>({name:H,description:J.get(H)||""})),console.log("[PublishModal] Updated formData.parameters with requirements:",v.parameters)}else v.parameters=[],console.log("[PublishModal] No parameters in plan template, cleared formData.parameters")}catch(O){console.error("[PublishModal] Failed to load parameter requirements:",O),O instanceof Error&&!O.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),S.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[]}finally{w.value=!1}},P=()=>{console.log("[PublishModal] Starting parameter merge"),console.log("[PublishModal] Frontend parameters:",S.value.parameters),console.log("[PublishModal] Form parameters:",v.parameters);const T=a.selectedTemplate.value?.toolConfig?.inputSchema||[];console.log("[PublishModal] Backend inputSchema:",T);const O=new Map;if(T.forEach(J=>{J.name&&O.set(J.name,J.description||"")}),S.value.hasParameters){const J=S.value.parameters.map(H=>{const Y=v.parameters.find(ne=>ne.name===H)?.description||""||O.get(H)||"";return{name:H,description:Y}});return console.log("[PublishModal] Merged parameters (from plan template):",J),J}return console.log("[PublishModal] No parameters in plan template, clearing backend parameters"),[]},U=(T,O)=>{O==="success"?(i.value=T,setTimeout(()=>{i.value=""},3e3)):O==="error"&&(u.value=T,setTimeout(()=>{u.value=""},5e3))},D=()=>{if(!v.userRequest.trim())return U(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return U(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return U(s("mcpService.toolNameRequiredError"),"error"),!1;if(!m.value&&!E.value)return U("Please select at least one service type","error"),!1;for(let J=0;J<v.parameters.length;J++){const H=v.parameters[J];if(H.name&&!H.description.trim())return U(`Parameter "${H.name}" description cannot be empty`,"error"),!1;if(H.description&&!H.name.trim())return U(`Parameter description "${H.description}" corresponding name cannot be empty`,"error"),!1}return!0},q=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",v),console.log("[PublishModal] Publish as HTTP service:",E.value),!D()){console.log("[PublishModal] Form validation failed");return}f.value=!0;try{const T=P();console.log("[PublishModal] Merged parameters:",T);const O=T.filter(X=>X.name.trim()).map(X=>({name:X.name.trim(),description:X.description.trim()||"",type:"string"}));if(a.setToolDescriptionWithGuard(v.userRequest.trim()),a.setEnableInternalToolcallWithGuard(m.value),a.setEnableHttpServiceWithGuard(E.value),a.setInputSchemaWithGuard(O),!await a.save())throw new Error("Failed to save plan template");const H=[];m.value&&H.push("Internal Method Call"),E.value&&H.push("HTTP Service"),H.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",H.join(", ")),U(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),d("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),U(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),d("published",null))}catch(T){console.error("[PublishModal] Failed to publish service:",T);const O=T instanceof Error?T.message:"Unknown error";U(s("mcpService.publishFailed")+": "+O,"error")}finally{f.value=!1}},$=async()=>{if(k.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const T=a.currentPlanTemplateId.value;if(!T){U(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}k.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",T),a.setToolConfigWithGuard(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),U(s("mcpService.deleteSuccess"),"success"),y.value=!1,d("published",null)}catch(O){console.error("[PublishModal] Failed to delete tool config:",O);const J=O instanceof Error?O.message:"Unknown error";U(s("mcpService.deleteFailed")+": "+J,"error")}finally{k.value=!1}};return be(()=>r.modelValue,async()=>{y.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),L(),await b())}),be(()=>a.currentPlanTemplateId.value,(T,O)=>{T&&T!==O&&(O&&T.startsWith("planTemplate-")?setTimeout(()=>{b()},1e3):b())}),Me(async()=>{y.value&&(console.log("[PublishModal] Initialize when component mounted"),L(),await b())}),t({loadParameterRequirements:b}),(T,O)=>(h(),g(fe,null,[x(Ss,{modelValue:y.value,"onUpdate:modelValue":O[3]||(O[3]=J=>y.value=J),title:N.value,onConfirm:q},{footer:ze(()=>[o("div",Si,[W.value?(h(),g("button",{key:0,class:"action-btn danger",onClick:$,disabled:k.value},[k.value?(h(),Se(p(F),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),Se(p(F),{key:1,icon:"carbon:trash-can"})),me(" "+c(k.value?p(s)("mcpService.deleting"):p(s)("mcpService.delete")),1)],8,Pi)):B("",!0),o("button",{class:"action-btn primary",onClick:q,disabled:f.value},[f.value?(h(),Se(p(F),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),Se(p(F),{key:1,icon:"carbon:cloud-upload"})),me(" "+c(f.value?p(s)("mcpService.publishing"):p(s)("mcpService.publishAsService")),1)],8,Ti)])]),default:ze(()=>[o("div",si,[o("div",oi,[o("div",ni,[o("label",null,c(p(s)("mcpService.toolDescriptionRequired")),1),we(o("textarea",{"onUpdate:modelValue":O[0]||(O[0]=J=>v.userRequest=J),placeholder:p(s)("mcpService.toolDescriptionPlaceholder"),class:ge([{error:!v.userRequest||!v.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,ai),[[Ce,v.userRequest]]),o("div",li,c(p(s)("mcpService.toolDescriptionDescription")),1)])]),o("div",ri,[o("div",ii,c(p(s)("mcpService.parameterConfig")),1),S.value.hasParameters?(h(),g("div",ci,c(p(s)("sidebar.parameterRequirementsHelp")),1)):B("",!0),o("div",ui,[o("table",null,[o("thead",null,[o("tr",null,[o("th",null,c(p(s)("mcpService.parameterName")),1),o("th",null,c(p(s)("mcpService.parameterDescription")),1)])]),o("tbody",null,[(h(!0),g(fe,null,ye(v.parameters,(J,H)=>(h(),g("tr",{key:H},[o("td",null,[we(o("input",{type:"text","onUpdate:modelValue":X=>J.name=X,placeholder:p(s)("mcpService.parameterName"),class:ge(["parameter-input",{"readonly-input":S.value.hasParameters}]),readonly:S.value.hasParameters,required:""},null,10,di),[[Ce,J.name]])]),o("td",null,[we(o("input",{type:"text","onUpdate:modelValue":X=>J.description=X,placeholder:p(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,pi),[[Ce,J.description]])])]))),128))])])])]),o("div",mi,[o("div",hi,[o("div",fi,[o("label",vi,[we(o("input",{type:"checkbox","onUpdate:modelValue":O[1]||(O[1]=J=>m.value=J),class:"checkbox-input"},null,512),[[Dt,m.value]]),o("span",gi,c(p(s)("mcpService.publishAsInternalToolcall")),1)]),o("div",yi,c(p(s)("mcpService.publishAsInternalToolcallDescription")),1)]),o("div",bi,[o("label",_i,[we(o("input",{type:"checkbox","onUpdate:modelValue":O[2]||(O[2]=J=>E.value=J),class:"checkbox-input"},null,512),[[Dt,E.value]]),o("span",wi,c(p(s)("mcpService.publishAsHttpService")),1)]),o("div",$i,c(p(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),u.value?(h(),g("div",{key:0,class:"error-toast",onClick:O[4]||(O[4]=J=>u.value="")},[x(p(F),{icon:"carbon:error"}),me(" "+c(u.value),1)])):B("",!0),i.value?(h(),g("div",{key:1,class:"success-toast",onClick:O[5]||(O[5]=J=>i.value="")},[x(p(F),{icon:"carbon:checkmark"}),me(" "+c(i.value),1)])):B("",!0)],64))}}),ki=ke(Ei,[["__scopeId","data-v-235a4588"]]),Ci={class:"modal-header"},Ii={class:"modal-body"},Ri={class:"modal-footer"},xi=["disabled"],Ai=Ee({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(n,{emit:t}){const e=t,s=A(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},r=()=>{e("continue"),e("update:modelValue",!1)};return(d,y)=>d.modelValue?(h(),g("div",{key:0,class:"modal-overlay",onClick:a},[o("div",{class:"modal-content",onClick:y[0]||(y[0]=$e(()=>{},["stop"]))},[o("div",Ci,[o("h3",null,c(d.$t("sidebar.saveConfirmationTitle")),1),o("button",{class:"close-btn",onClick:a},[x(p(F),{icon:"carbon:close",width:"16"})])]),o("div",Ii,[o("p",null,c(d.$t("sidebar.saveConfirmationMessage")),1)]),o("div",Ri,[o("button",{class:"btn btn-secondary",onClick:a},c(d.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(h(),Se(p(F),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):B("",!0),me(" "+c(s.value?d.$t("sidebar.saving"):d.$t("common.save")),1)],8,xi),o("button",{class:"btn btn-danger",onClick:r},c(d.$t("sidebar.continueWithoutSave")),1)])])])):B("",!0)}}),Fi=ke(Ai,[["__scopeId","data-v-4817656d"]]),Mi={class:"config-section"},Di={class:"section-header"},Ni={class:"execution-content"},Ui={class:"params-requirements-group"},Li={class:"params-help-text"},Oi={key:0,class:"parameter-fields"},qi={class:"parameter-label"},Bi=["onUpdate:modelValue","placeholder","onInput"],Hi={key:0,class:"parameter-error"},Vi={key:1,class:"validation-message"},ji=["disabled"],zi=["disabled"],Wi={key:1,class:"call-example-wrapper"},Gi={class:"call-example-header"},Ki={class:"call-example-title"},Ji={class:"call-example-description"},Xi={class:"internal-call-wrapper"},Yi={class:"call-info"},Qi={class:"call-method"},Zi={class:"call-endpoint"},ec={key:0,class:"call-endpoint"},tc={class:"call-description"},sc={class:"call-example"},oc={class:"example-code"},nc={key:2,class:"call-example-wrapper"},ac={class:"call-example-header"},lc={class:"call-example-title"},rc={class:"call-example-description"},ic={class:"http-api-urls-wrapper"},cc={class:"tab-container"},uc={class:"tab-header"},dc=["onClick"],pc={class:"tab-content"},mc={class:"http-api-url-display"},hc={class:"api-method"},fc={class:"api-endpoint"},vc={class:"api-description"},gc={key:0,class:"api-example"},yc={class:"example-code"},bc={key:3,class:"call-example-wrapper"},_c={class:"call-example-header"},wc={class:"call-example-title"},$c={class:"call-example-description"},Sc={class:"mcp-call-wrapper"},Pc={class:"call-info"},Tc={class:"call-method"},Ec={class:"call-endpoint"},kc={class:"call-description"},Cc={class:"call-example"},Ic={class:"example-code"},Rc=Ee({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=wt(),a=Ge(),l=et(),r=Ze(),d=n,y=A(""),u=A(!1),i=A({parameters:[],hasParameters:!1,requirements:""}),f=A({}),k=A(!1),E=A("post-async"),m=A({}),S=A(!1),w=A(!1),v=A(null),N=re(()=>a.getCoordinatorToolConfig()),W=A(),L=A([]),b=A(null),P=A(!1),U=A(null),D=re(()=>{const j=a.selectedTemplate.value?.title||"my-tool",R=a.selectedTemplate.value?.serviceGroup||"research",z=a.selectedTemplate.value?.planTemplateId||"template-456",ee={};i.value.hasParameters&&i.value.parameters.length>0?i.value.parameters.forEach(_e=>{ee[_e]=f.value[_e]||"test"}):ee.rawParam="test";const le=v.value||e("sidebar.defaultPlanId"),ae=v.value||e("sidebar.defaultPlanIdDetails");return[{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "${j}",
  "serviceGroup": "${R}",
  "replacementParams": ${JSON.stringify(ee,null,2)},
  "uploadedFiles": []
}

Response: {
  "planId": "${le}",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "${j}",
  "planTemplateId": "${z}"
}

# Check execution status and get detailed results:
GET /api/executor/details/${ae}
Response: {
  "currentPlanId": "${le}",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "${j}",
  "serviceGroup": "${R}",
  "replacementParams": ${JSON.stringify(ee,null,2)},
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`}]}),q=re(()=>{const j=a.selectedTemplate.value?.toolConfig;return j?.enableInternalToolcall??j?.enableHttpService??j?.enableMcpService??!1}),$=re(()=>q.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),I=re(()=>l.isLoading.value),T=re(()=>{if(I.value||d.isExecuting||w.value)return!1;const j=r.trackedPlanIds.value.size>0,z=Array.from(r.planExecutionRecords.entries()).some(([,ee])=>ee&&!ee.completed&&ee.status!=="failed");return j||z?!1:i.value.hasParameters?i.value.parameters.every(ee=>{const le=f.value[ee];return typeof le=="string"&&le.trim()!==""}):!0}),O=(j,R)=>{L.value=j.map(z=>z.originalName),b.value=R,console.log("[ExecutionController] Files uploaded:",j.length,"uploadKey:",R)},J=j=>{L.value=j.map(R=>R.originalName),console.log("[ExecutionController] Files removed, remaining:",j.length)},H=j=>{b.value=j,console.log("[ExecutionController] Upload key changed:",j)},X=()=>{console.log("[ExecutionController] Upload started")},se=()=>{console.log("[ExecutionController] Upload completed")},Y=j=>{console.error("[ExecutionController] Upload error:",j)},ne=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),d.isExecuting||l.isLoading.value||w.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",d.isExecuting,l.isLoading.value,w.value),s.error(e("sidebar.executionInProgress"));return}if(pe.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!he()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value);return}const j=i.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;U.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:j,uploadedFiles:L.value,uploadKey:b.value},P.value=!0;return}await Pe()},Pe=async()=>{if(d.isExecuting||l.isLoading.value||w.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(w.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!he()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value),w.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),w.value=!1;return}const j=a.getConfig(),R=a.selectedTemplate.value.planTemplateId||j.planTemplateId,z={title:j.title||a.selectedTemplate.value.title||"Execution Plan",steps:(j.steps||[]).map(Ke=>({stepRequirement:Ke.stepRequirement||"",agentName:Ke.agentName||"",modelName:Ke.modelName||null,selectedToolKeys:[],terminateColumns:Ke.terminateColumns||"",stepContent:""})),directResponse:j.directResponse||!1,...R&&{planTemplateId:R},...j.planType&&{planType:j.planType}},ee=a.selectedTemplate.value.title??j.title??"Execution Plan",le=i.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",le),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(z,null,2));const ae={title:ee,planData:z,params:void 0,replacementParams:le,uploadedFiles:L.value,uploadKey:b.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(ae,null,2));const _e=await l.executePlan(ae);_e.success?(console.log("[ExecutionController] âœ… Plan execution started successfully:",_e.planId),_e.planId&&(v.value=_e.planId,console.log("[ExecutionController] ðŸ“ Tracked planId for API examples:",v.value))):(console.error("[ExecutionController] âŒ Plan execution failed:",_e.error),s.error(_e.error||e("sidebar.executeFailed")))}catch(j){console.error("[ExecutionController] âŒ Error executing plan:",j);const R=j instanceof Error?j.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+R),w.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),G(),console.log("[ExecutionController] âœ… Cleanup completed")}},de=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const j=a.validate();if(!j.isValid){s.error(`Invalid format, please correct and save.
Errors: `+j.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const ee=a.generateJsonString().trim();a.updateVersionsAfterSave(ee);const le=a.planVersions.value.length;pe.hasTaskRequirementModified=!1,await new Promise(ae=>setTimeout(ae,500)),await Z(),await pe.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:le})),await new Promise(ae=>setTimeout(ae,500)),U.value&&(await Pe(),U.value=null)}catch(j){console.error("[ExecutionController] âŒ Failed to save before execute:",j);const R=j instanceof Error?j.message:e("sidebar.saveFailed");throw s.error(R),j}},M=async()=>{console.log("[ExecutionController] â© Continue without save requested"),U.value&&(await Pe(),U.value=null)},V=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}u.value=!0},G=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),y.value="",f.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},Z=async()=>{await new Promise(j=>setTimeout(j,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(j=>j.stepRequirement).join(" ||| ")),await new Promise(j=>setTimeout(j,200)),await oe()},oe=async()=>{const j=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",j),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(i.value,null,2)),!j){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),i.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}i.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),k.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const R=await ks.getParameterRequirements(j);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(R,null,2)),i.value=R;const z={};R.parameters.forEach(ee=>{z[ee]=f.value[ee]||""}),f.value=z,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(i.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(f.value,null,2)),te()}catch(R){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",R),R instanceof Error&&!R.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),i.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(i.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(f.value,null,2))}finally{k.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},ie=(j,R)=>{f.value[j]=R,m.value[j]&&delete m.value[j],te()},he=()=>{if(m.value={},S.value=!1,!i.value.hasParameters)return!0;let j=!1;return i.value.parameters.forEach(R=>{(f.value[R]?f.value[R].trim():"")||(m.value[R]=`${R} is required`,j=!0)}),S.value=j,!j},te=()=>{i.value.hasParameters?y.value=JSON.stringify(f.value,null,2):y.value=""};return be(()=>a.currentPlanTemplateId.value,(j,R)=>{if(j&&j!==R){if(w.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),R&&j.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),oe()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),oe())}}),be(()=>pe.hasTaskRequirementModified,async(j,R)=>{if(R===!0&&j===!1&&a.currentPlanTemplateId.value){if(w.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(z=>setTimeout(z,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await Z()}}),_s(()=>{const j=r.planExecutionRecords,R=Array.from(j.entries()),z=r.trackedPlanIds.value.size>0,ee=R.some(([,ae])=>ae&&!ae.completed&&ae.status!=="failed");!(z||ee)&&w.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan",{hasTrackedPlans:z,hasRunningPlansInRecords:ee,trackedPlanIds:Array.from(r.trackedPlanIds.value),recordsCount:R.length}),w.value=!1)}),Me(()=>{oe()}),t({executionParams:y,clearExecutionParams:G,loadParameterRequirements:oe,refreshParameterRequirements:Z,fileUploadRef:W,uploadedFiles:L,uploadKey:b}),(j,R)=>(h(),g(fe,null,[o("div",Mi,[o("div",Di,[x(p(F),{icon:"carbon:play",width:"16"}),o("span",null,c(p(e)("sidebar.executionController")),1)]),o("div",Ni,[o("div",Ui,[o("label",null,c(p(e)("sidebar.parameterRequirements")),1),o("div",Li,c(p(e)("sidebar.parameterRequirementsHelp")),1),i.value.hasParameters?(h(),g("div",Oi,[(h(!0),g(fe,null,ye(i.value.parameters,z=>(h(),g("div",{key:z,class:"parameter-field"},[o("label",qi,[me(c(z)+" ",1),R[2]||(R[2]=o("span",{class:"required"},"*",-1))]),we(o("input",{"onUpdate:modelValue":ee=>f.value[z]=ee,class:ge(["parameter-input",{error:m.value[z]}]),placeholder:p(e)("sidebar.enterValueFor",{param:z}),onInput:ee=>ie(z,ee.target.value),required:""},null,42,Bi),[[Ce,f.value[z]]]),m.value[z]?(h(),g("div",Hi,c(m.value[z]),1)):B("",!0)]))),128))])):B("",!0),i.value.hasParameters&&!T.value&&!d.isExecuting?(h(),g("div",Vi,[x(p(F),{icon:"carbon:warning",width:"14"}),me(" "+c(p(e)("sidebar.fillAllRequiredParameters")),1)])):B("",!0)]),x(Es,{ref_key:"fileUploadRef",ref:W,disabled:d.isExecuting,onFilesUploaded:O,onFilesRemoved:J,onUploadKeyChanged:H,onUploadStarted:X,onUploadCompleted:se,onUploadError:Y},null,8,["disabled"]),o("button",{class:"btn btn-primary execute-btn",onClick:ne,disabled:!T.value},[x(p(F),{icon:d.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ge({spinning:d.isExecuting})},null,8,["icon","class"]),me(" "+c(d.isExecuting?p(e)("sidebar.executing"):p(e)("sidebar.executePlan")),1)],8,ji),N.value?(h(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:V,disabled:!p(a).currentPlanTemplateId.value},[x(p(F),{icon:"carbon:application",width:"16"}),me(" "+c($.value),1)],8,zi)):B("",!0),p(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),g("div",Wi,[o("div",Gi,[o("h4",Ki,c(p(e)("sidebar.internalCall")),1),o("p",Ji,c(p(e)("sidebar.internalCallDescription")),1)]),o("div",Xi,[o("div",Yi,[o("div",Qi,c(p(e)("sidebar.internalMethodCall")),1),o("div",Zi,c(p(e)("sidebar.toolName"))+": "+c(p(a).selectedTemplate.value?.title||p(a).currentPlanTemplateId.value||""),1),p(a).selectedTemplate.value?.serviceGroup?(h(),g("div",ec,c(p(e)("sidebar.serviceGroup"))+": "+c(p(a).selectedTemplate.value.serviceGroup),1)):B("",!0),o("div",tc,c(p(e)("sidebar.internalCallUsage")),1),o("div",sc,[o("strong",null,c(p(e)("sidebar.usage"))+":",1),o("pre",oc,c(p(e)("sidebar.internalCallExample")),1)])])])])):B("",!0),p(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),g("div",nc,[o("div",ac,[o("h4",lc,c(p(e)("sidebar.httpCallExample")),1),o("p",rc,c(p(e)("sidebar.httpCallDescription")),1)]),o("div",ic,[o("div",cc,[o("div",uc,[(h(!0),g(fe,null,ye(D.value,z=>(h(),g("button",{key:z.id,class:ge(["tab-button",{active:E.value===z.id}]),onClick:ee=>E.value=z.id},c(z.label),11,dc))),128))]),o("div",pc,[(h(!0),g(fe,null,ye(D.value,z=>we((h(),g("div",{key:z.id,class:"tab-panel"},[o("div",mc,[o("div",hc,c(z.method),1),o("div",fc,c(z.endpoint),1),o("div",vc,c(z.description),1),z.example?(h(),g("div",gc,[o("strong",null,c(p(e)("sidebar.example"))+":",1),o("pre",yc,c(z.example),1)])):B("",!0)])])),[[ho,E.value===z.id]])),128))])])])])):B("",!0),p(a).selectedTemplate.value?.toolConfig?.enableMcpService?(h(),g("div",bc,[o("div",_c,[o("h4",wc,c(p(e)("sidebar.mcpCall")),1),o("p",$c,c(p(e)("sidebar.mcpCallDescription")),1)]),o("div",Sc,[o("div",Pc,[o("div",Tc,c(p(e)("sidebar.mcpServiceCall")),1),o("div",Ec,c(p(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),o("div",kc,c(p(e)("sidebar.mcpCallUsage")),1),o("div",Cc,[o("strong",null,c(p(e)("sidebar.usage"))+":",1),o("pre",Ic,c(p(e)("sidebar.mcpCallExample")),1)])])])])):B("",!0)])]),x(Fi,{modelValue:P.value,"onUpdate:modelValue":R[0]||(R[0]=z=>P.value=z),onSave:de,onContinue:M},null,8,["modelValue"]),x(ki,{modelValue:u.value,"onUpdate:modelValue":R[1]||(R[1]=z=>u.value=z)},null,8,["modelValue"])],64))}}),xc=ke(Rc,[["__scopeId","data-v-9b39e14b"]]);function Is(n,t){return function(){return n.apply(t,arguments)}}const{toString:Ac}=Object.prototype,{getPrototypeOf:Ht}=Object,{iterator:$t,toStringTag:Rs}=Symbol,St=(n=>t=>{const e=Ac.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Le=n=>(n=n.toLowerCase(),t=>St(t)===n),Pt=n=>t=>typeof t===n,{isArray:tt}=Array,Qe=Pt("undefined");function lt(n){return n!==null&&!Qe(n)&&n.constructor!==null&&!Qe(n.constructor)&&Ae(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const xs=Le("ArrayBuffer");function Fc(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&xs(n.buffer),t}const Mc=Pt("string"),Ae=Pt("function"),As=Pt("number"),rt=n=>n!==null&&typeof n=="object",Dc=n=>n===!0||n===!1,ft=n=>{if(St(n)!=="object")return!1;const t=Ht(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Rs in n)&&!($t in n)},Nc=n=>{if(!rt(n)||lt(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},Uc=Le("Date"),Lc=Le("File"),Oc=Le("Blob"),qc=Le("FileList"),Bc=n=>rt(n)&&Ae(n.pipe),Hc=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||Ae(n.append)&&((t=St(n))==="formdata"||t==="object"&&Ae(n.toString)&&n.toString()==="[object FormData]"))},Vc=Le("URLSearchParams"),[jc,zc,Wc,Gc]=["ReadableStream","Request","Response","Headers"].map(Le),Kc=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function it(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let s,a;if(typeof n!="object"&&(n=[n]),tt(n))for(s=0,a=n.length;s<a;s++)t.call(null,n[s],s,n);else{if(lt(n))return;const l=e?Object.getOwnPropertyNames(n):Object.keys(n),r=l.length;let d;for(s=0;s<r;s++)d=l[s],t.call(null,n[d],d,n)}}function Fs(n,t){if(lt(n))return null;t=t.toLowerCase();const e=Object.keys(n);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const Ve=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ms=n=>!Qe(n)&&n!==Ve;function Ut(){const{caseless:n,skipUndefined:t}=Ms(this)&&this||{},e={},s=(a,l)=>{const r=n&&Fs(e,l)||l;ft(e[r])&&ft(a)?e[r]=Ut(e[r],a):ft(a)?e[r]=Ut({},a):tt(a)?e[r]=a.slice():(!t||!Qe(a))&&(e[r]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&it(arguments[a],s);return e}const Jc=(n,t,e,{allOwnKeys:s}={})=>(it(t,(a,l)=>{e&&Ae(a)?n[l]=Is(a,e):n[l]=a},{allOwnKeys:s}),n),Xc=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Yc=(n,t,e,s)=>{n.prototype=Object.create(t.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},Qc=(n,t,e,s)=>{let a,l,r;const d={};if(t=t||{},n==null)return t;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)r=a[l],(!s||s(r,n,t))&&!d[r]&&(t[r]=n[r],d[r]=!0);n=e!==!1&&Ht(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},Zc=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const s=n.indexOf(t,e);return s!==-1&&s===e},eu=n=>{if(!n)return null;if(tt(n))return n;let t=n.length;if(!As(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},tu=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&Ht(Uint8Array)),su=(n,t)=>{const s=(n&&n[$t]).call(n);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(n,l[0],l[1])}},ou=(n,t)=>{let e;const s=[];for(;(e=n.exec(t))!==null;)s.push(e);return s},nu=Le("HTMLFormElement"),au=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),ss=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),lu=Le("RegExp"),Ds=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),s={};it(e,(a,l)=>{let r;(r=t(a,l,n))!==!1&&(s[l]=r||a)}),Object.defineProperties(n,s)},ru=n=>{Ds(n,(t,e)=>{if(Ae(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=n[e];if(Ae(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},iu=(n,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return tt(n)?s(n):s(String(n).split(t)),e},cu=()=>{},uu=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t;function du(n){return!!(n&&Ae(n.append)&&n[Rs]==="FormData"&&n[$t])}const pu=n=>{const t=new Array(10),e=(s,a)=>{if(rt(s)){if(t.indexOf(s)>=0)return;if(lt(s))return s;if(!("toJSON"in s)){t[a]=s;const l=tt(s)?[]:{};return it(s,(r,d)=>{const y=e(r,a+1);!Qe(y)&&(l[d]=y)}),t[a]=void 0,l}}return s};return e(n,0)},mu=Le("AsyncFunction"),hu=n=>n&&(rt(n)||Ae(n))&&Ae(n.then)&&Ae(n.catch),Ns=((n,t)=>n?setImmediate:t?((e,s)=>(Ve.addEventListener("message",({source:a,data:l})=>{a===Ve&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),Ve.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Ae(Ve.postMessage)),fu=typeof queueMicrotask<"u"?queueMicrotask.bind(Ve):typeof process<"u"&&process.nextTick||Ns,vu=n=>n!=null&&Ae(n[$t]),C={isArray:tt,isArrayBuffer:xs,isBuffer:lt,isFormData:Hc,isArrayBufferView:Fc,isString:Mc,isNumber:As,isBoolean:Dc,isObject:rt,isPlainObject:ft,isEmptyObject:Nc,isReadableStream:jc,isRequest:zc,isResponse:Wc,isHeaders:Gc,isUndefined:Qe,isDate:Uc,isFile:Lc,isBlob:Oc,isRegExp:lu,isFunction:Ae,isStream:Bc,isURLSearchParams:Vc,isTypedArray:tu,isFileList:qc,forEach:it,merge:Ut,extend:Jc,trim:Kc,stripBOM:Xc,inherits:Yc,toFlatObject:Qc,kindOf:St,kindOfTest:Le,endsWith:Zc,toArray:eu,forEachEntry:su,matchAll:ou,isHTMLForm:nu,hasOwnProperty:ss,hasOwnProp:ss,reduceDescriptors:Ds,freezeMethods:ru,toObjectSet:iu,toCamelCase:au,noop:cu,toFiniteNumber:uu,findKey:Fs,global:Ve,isContextDefined:Ms,isSpecCompliantForm:du,toJSONObject:pu,isAsyncFn:mu,isThenable:hu,setImmediate:Ns,asap:fu,isIterable:vu};function ue(n,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}C.inherits(ue,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const Us=ue.prototype,Ls={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Ls[n]={value:n}});Object.defineProperties(ue,Ls);Object.defineProperty(Us,"isAxiosError",{value:!0});ue.from=(n,t,e,s,a,l)=>{const r=Object.create(Us);C.toFlatObject(n,r,function(i){return i!==Error.prototype},u=>u!=="isAxiosError");const d=n&&n.message?n.message:"Error",y=t==null&&n?n.code:t;return ue.call(r,d,y,e,s,a),n&&r.cause==null&&Object.defineProperty(r,"cause",{value:n,configurable:!0}),r.name=n&&n.name||"Error",l&&Object.assign(r,l),r};const gu=null;function Lt(n){return C.isPlainObject(n)||C.isArray(n)}function Os(n){return C.endsWith(n,"[]")?n.slice(0,-2):n}function os(n,t,e){return n?n.concat(t).map(function(a,l){return a=Os(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function yu(n){return C.isArray(n)&&!n.some(Lt)}const bu=C.toFlatObject(C,{},null,function(t){return/^is[A-Z]/.test(t)});function Tt(n,t,e){if(!C.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=C.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,w){return!C.isUndefined(w[S])});const s=e.metaTokens,a=e.visitor||i,l=e.dots,r=e.indexes,y=(e.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(t);if(!C.isFunction(a))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(C.isDate(m))return m.toISOString();if(C.isBoolean(m))return m.toString();if(!y&&C.isBlob(m))throw new ue("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(m)||C.isTypedArray(m)?y&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function i(m,S,w){let v=m;if(m&&!w&&typeof m=="object"){if(C.endsWith(S,"{}"))S=s?S:S.slice(0,-2),m=JSON.stringify(m);else if(C.isArray(m)&&yu(m)||(C.isFileList(m)||C.endsWith(S,"[]"))&&(v=C.toArray(m)))return S=Os(S),v.forEach(function(W,L){!(C.isUndefined(W)||W===null)&&t.append(r===!0?os([S],L,l):r===null?S:S+"[]",u(W))}),!1}return Lt(m)?!0:(t.append(os(w,S,l),u(m)),!1)}const f=[],k=Object.assign(bu,{defaultVisitor:i,convertValue:u,isVisitable:Lt});function E(m,S){if(!C.isUndefined(m)){if(f.indexOf(m)!==-1)throw Error("Circular reference detected in "+S.join("."));f.push(m),C.forEach(m,function(v,N){(!(C.isUndefined(v)||v===null)&&a.call(t,v,C.isString(N)?N.trim():N,S,k))===!0&&E(v,S?S.concat(N):[N])}),f.pop()}}if(!C.isObject(n))throw new TypeError("data must be an object");return E(n),t}function ns(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Vt(n,t){this._pairs=[],n&&Tt(n,this,t)}const qs=Vt.prototype;qs.append=function(t,e){this._pairs.push([t,e])};qs.toString=function(t){const e=t?function(s){return t.call(this,s,ns)}:ns;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function _u(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Bs(n,t,e){if(!t)return n;const s=e&&e.encode||_u;C.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=C.isURLSearchParams(t)?t.toString():new Vt(t,e).toString(s),l){const r=n.indexOf("#");r!==-1&&(n=n.slice(0,r)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class as{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){C.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Hs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wu=typeof URLSearchParams<"u"?URLSearchParams:Vt,$u=typeof FormData<"u"?FormData:null,Su=typeof Blob<"u"?Blob:null,Pu={isBrowser:!0,classes:{URLSearchParams:wu,FormData:$u,Blob:Su},protocols:["http","https","file","blob","url","data"]},jt=typeof window<"u"&&typeof document<"u",Ot=typeof navigator=="object"&&navigator||void 0,Tu=jt&&(!Ot||["ReactNative","NativeScript","NS"].indexOf(Ot.product)<0),Eu=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ku=jt&&window.location.href||"http://localhost",Cu=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jt,hasStandardBrowserEnv:Tu,hasStandardBrowserWebWorkerEnv:Eu,navigator:Ot,origin:ku},Symbol.toStringTag,{value:"Module"})),Re={...Cu,...Pu};function Iu(n,t){return Tt(n,new Re.classes.URLSearchParams,{visitor:function(e,s,a,l){return Re.isNode&&C.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Ru(n){return C.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function xu(n){const t={},e=Object.keys(n);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=n[l];return t}function Vs(n){function t(e,s,a,l){let r=e[l++];if(r==="__proto__")return!0;const d=Number.isFinite(+r),y=l>=e.length;return r=!r&&C.isArray(a)?a.length:r,y?(C.hasOwnProp(a,r)?a[r]=[a[r],s]:a[r]=s,!d):((!a[r]||!C.isObject(a[r]))&&(a[r]=[]),t(e,s,a[r],l)&&C.isArray(a[r])&&(a[r]=xu(a[r])),!d)}if(C.isFormData(n)&&C.isFunction(n.entries)){const e={};return C.forEachEntry(n,(s,a)=>{t(Ru(s),a,e,0)}),e}return null}function Au(n,t,e){if(C.isString(n))try{return(t||JSON.parse)(n),C.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(n)}const ct={transitional:Hs,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=C.isObject(t);if(l&&C.isHTMLForm(t)&&(t=new FormData(t)),C.isFormData(t))return a?JSON.stringify(Vs(t)):t;if(C.isArrayBuffer(t)||C.isBuffer(t)||C.isStream(t)||C.isFile(t)||C.isBlob(t)||C.isReadableStream(t))return t;if(C.isArrayBufferView(t))return t.buffer;if(C.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Iu(t,this.formSerializer).toString();if((d=C.isFileList(t))||s.indexOf("multipart/form-data")>-1){const y=this.env&&this.env.FormData;return Tt(d?{"files[]":t}:t,y&&new y,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),Au(t)):t}],transformResponse:[function(t){const e=this.transitional||ct.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(C.isResponse(t)||C.isReadableStream(t))return t;if(t&&C.isString(t)&&(s&&!this.responseType||a)){const r=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(d){if(r)throw d.name==="SyntaxError"?ue.from(d,ue.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Re.classes.FormData,Blob:Re.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],n=>{ct.headers[n]={}});const Fu=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Mu=n=>{const t={};let e,s,a;return n&&n.split(`
`).forEach(function(r){a=r.indexOf(":"),e=r.substring(0,a).trim().toLowerCase(),s=r.substring(a+1).trim(),!(!e||t[e]&&Fu[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},ls=Symbol("internals");function nt(n){return n&&String(n).trim().toLowerCase()}function vt(n){return n===!1||n==null?n:C.isArray(n)?n.map(vt):String(n)}function Du(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(n);)t[s[1]]=s[2];return t}const Nu=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Rt(n,t,e,s,a){if(C.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!C.isString(t)){if(C.isString(s))return t.indexOf(s)!==-1;if(C.isRegExp(s))return s.test(t)}}function Uu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Lu(n,t){const e=C.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+e,{value:function(a,l,r){return this[s].call(this,t,a,l,r)},configurable:!0})})}let Fe=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(d,y,u){const i=nt(y);if(!i)throw new Error("header name must be a non-empty string");const f=C.findKey(a,i);(!f||a[f]===void 0||u===!0||u===void 0&&a[f]!==!1)&&(a[f||y]=vt(d))}const r=(d,y)=>C.forEach(d,(u,i)=>l(u,i,y));if(C.isPlainObject(t)||t instanceof this.constructor)r(t,e);else if(C.isString(t)&&(t=t.trim())&&!Nu(t))r(Mu(t),e);else if(C.isObject(t)&&C.isIterable(t)){let d={},y,u;for(const i of t){if(!C.isArray(i))throw TypeError("Object iterator must return a key-value pair");d[u=i[0]]=(y=d[u])?C.isArray(y)?[...y,i[1]]:[y,i[1]]:i[1]}r(d,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=nt(t),t){const s=C.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return Du(a);if(C.isFunction(e))return e.call(this,a,s);if(C.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=nt(t),t){const s=C.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Rt(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(r){if(r=nt(r),r){const d=C.findKey(s,r);d&&(!e||Rt(s,s[d],d,e))&&(delete s[d],a=!0)}}return C.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||Rt(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return C.forEach(this,(a,l)=>{const r=C.findKey(s,l);if(r){e[r]=vt(a),delete e[l];return}const d=t?Uu(l):String(l).trim();d!==l&&delete e[l],e[d]=vt(a),s[d]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return C.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&C.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[ls]=this[ls]={accessors:{}}).accessors,a=this.prototype;function l(r){const d=nt(r);s[d]||(Lu(a,r),s[d]=!0)}return C.isArray(t)?t.forEach(l):l(t),this}};Fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(Fe.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[e]=s}}});C.freezeMethods(Fe);function xt(n,t){const e=this||ct,s=t||e,a=Fe.from(s.headers);let l=s.data;return C.forEach(n,function(d){l=d.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function js(n){return!!(n&&n.__CANCEL__)}function st(n,t,e){ue.call(this,n??"canceled",ue.ERR_CANCELED,t,e),this.name="CanceledError"}C.inherits(st,ue,{__CANCEL__:!0});function zs(n,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?n(e):t(new ue("Request failed with status code "+e.status,[ue.ERR_BAD_REQUEST,ue.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Ou(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function qu(n,t){n=n||10;const e=new Array(n),s=new Array(n);let a=0,l=0,r;return t=t!==void 0?t:1e3,function(y){const u=Date.now(),i=s[l];r||(r=u),e[a]=y,s[a]=u;let f=l,k=0;for(;f!==a;)k+=e[f++],f=f%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),u-r<t)return;const E=i&&u-i;return E?Math.round(k*1e3/E):void 0}}function Bu(n,t){let e=0,s=1e3/t,a,l;const r=(u,i=Date.now())=>{e=i,a=null,l&&(clearTimeout(l),l=null),n(...u)};return[(...u)=>{const i=Date.now(),f=i-e;f>=s?r(u,i):(a=u,l||(l=setTimeout(()=>{l=null,r(a)},s-f)))},()=>a&&r(a)]}const bt=(n,t,e=3)=>{let s=0;const a=qu(50,250);return Bu(l=>{const r=l.loaded,d=l.lengthComputable?l.total:void 0,y=r-s,u=a(y),i=r<=d;s=r;const f={loaded:r,total:d,progress:d?r/d:void 0,bytes:y,rate:u||void 0,estimated:u&&d&&i?(d-r)/u:void 0,event:l,lengthComputable:d!=null,[t?"download":"upload"]:!0};n(f)},e)},rs=(n,t)=>{const e=n!=null;return[s=>t[0]({lengthComputable:e,total:n,loaded:s}),t[1]]},is=n=>(...t)=>C.asap(()=>n(...t)),Hu=Re.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,Re.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(Re.origin),Re.navigator&&/(msie|trident)/i.test(Re.navigator.userAgent)):()=>!0,Vu=Re.hasStandardBrowserEnv?{write(n,t,e,s,a,l,r){if(typeof document>"u")return;const d=[`${n}=${encodeURIComponent(t)}`];C.isNumber(e)&&d.push(`expires=${new Date(e).toUTCString()}`),C.isString(s)&&d.push(`path=${s}`),C.isString(a)&&d.push(`domain=${a}`),l===!0&&d.push("secure"),C.isString(r)&&d.push(`SameSite=${r}`),document.cookie=d.join("; ")},read(n){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ju(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function zu(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function Ws(n,t,e){let s=!ju(t);return n&&(s||e==!1)?zu(n,t):t}const cs=n=>n instanceof Fe?{...n}:n;function We(n,t){t=t||{};const e={};function s(u,i,f,k){return C.isPlainObject(u)&&C.isPlainObject(i)?C.merge.call({caseless:k},u,i):C.isPlainObject(i)?C.merge({},i):C.isArray(i)?i.slice():i}function a(u,i,f,k){if(C.isUndefined(i)){if(!C.isUndefined(u))return s(void 0,u,f,k)}else return s(u,i,f,k)}function l(u,i){if(!C.isUndefined(i))return s(void 0,i)}function r(u,i){if(C.isUndefined(i)){if(!C.isUndefined(u))return s(void 0,u)}else return s(void 0,i)}function d(u,i,f){if(f in t)return s(u,i);if(f in n)return s(void 0,u)}const y={url:l,method:l,data:l,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:d,headers:(u,i,f)=>a(cs(u),cs(i),f,!0)};return C.forEach(Object.keys({...n,...t}),function(i){const f=y[i]||a,k=f(n[i],t[i],i);C.isUndefined(k)&&f!==d||(e[i]=k)}),e}const Gs=n=>{const t=We({},n);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:r,auth:d}=t;if(t.headers=r=Fe.from(r),t.url=Bs(Ws(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),d&&r.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),C.isFormData(e)){if(Re.hasStandardBrowserEnv||Re.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(C.isFunction(e.getHeaders)){const y=e.getHeaders(),u=["content-type","content-length"];Object.entries(y).forEach(([i,f])=>{u.includes(i.toLowerCase())&&r.set(i,f)})}}if(Re.hasStandardBrowserEnv&&(s&&C.isFunction(s)&&(s=s(t)),s||s!==!1&&Hu(t.url))){const y=a&&l&&Vu.read(l);y&&r.set(a,y)}return t},Wu=typeof XMLHttpRequest<"u",Gu=Wu&&function(n){return new Promise(function(e,s){const a=Gs(n);let l=a.data;const r=Fe.from(a.headers).normalize();let{responseType:d,onUploadProgress:y,onDownloadProgress:u}=a,i,f,k,E,m;function S(){E&&E(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(i),a.signal&&a.signal.removeEventListener("abort",i)}let w=new XMLHttpRequest;w.open(a.method.toUpperCase(),a.url,!0),w.timeout=a.timeout;function v(){if(!w)return;const W=Fe.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),b={data:!d||d==="text"||d==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:W,config:n,request:w};zs(function(U){e(U),S()},function(U){s(U),S()},b),w=null}"onloadend"in w?w.onloadend=v:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(v)},w.onabort=function(){w&&(s(new ue("Request aborted",ue.ECONNABORTED,n,w)),w=null)},w.onerror=function(L){const b=L&&L.message?L.message:"Network Error",P=new ue(b,ue.ERR_NETWORK,n,w);P.event=L||null,s(P),w=null},w.ontimeout=function(){let L=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const b=a.transitional||Hs;a.timeoutErrorMessage&&(L=a.timeoutErrorMessage),s(new ue(L,b.clarifyTimeoutError?ue.ETIMEDOUT:ue.ECONNABORTED,n,w)),w=null},l===void 0&&r.setContentType(null),"setRequestHeader"in w&&C.forEach(r.toJSON(),function(L,b){w.setRequestHeader(b,L)}),C.isUndefined(a.withCredentials)||(w.withCredentials=!!a.withCredentials),d&&d!=="json"&&(w.responseType=a.responseType),u&&([k,m]=bt(u,!0),w.addEventListener("progress",k)),y&&w.upload&&([f,E]=bt(y),w.upload.addEventListener("progress",f),w.upload.addEventListener("loadend",E)),(a.cancelToken||a.signal)&&(i=W=>{w&&(s(!W||W.type?new st(null,n,w):W),w.abort(),w=null)},a.cancelToken&&a.cancelToken.subscribe(i),a.signal&&(a.signal.aborted?i():a.signal.addEventListener("abort",i)));const N=Ou(a.url);if(N&&Re.protocols.indexOf(N)===-1){s(new ue("Unsupported protocol "+N+":",ue.ERR_BAD_REQUEST,n));return}w.send(l||null)})},Ku=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(u){if(!a){a=!0,d();const i=u instanceof Error?u:this.reason;s.abort(i instanceof ue?i:new st(i instanceof Error?i.message:i))}};let r=t&&setTimeout(()=>{r=null,l(new ue(`timeout ${t} of ms exceeded`,ue.ETIMEDOUT))},t);const d=()=>{n&&(r&&clearTimeout(r),r=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),n=null)};n.forEach(u=>u.addEventListener("abort",l));const{signal:y}=s;return y.unsubscribe=()=>C.asap(d),y}},Ju=function*(n,t){let e=n.byteLength;if(e<t){yield n;return}let s=0,a;for(;s<e;)a=s+t,yield n.slice(s,a),s=a},Xu=async function*(n,t){for await(const e of Yu(n))yield*Ju(e,t)},Yu=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const t=n.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},us=(n,t,e,s)=>{const a=Xu(n,t);let l=0,r,d=y=>{r||(r=!0,s&&s(y))};return new ReadableStream({async pull(y){try{const{done:u,value:i}=await a.next();if(u){d(),y.close();return}let f=i.byteLength;if(e){let k=l+=f;e(k)}y.enqueue(new Uint8Array(i))}catch(u){throw d(u),u}},cancel(y){return d(y),a.return()}},{highWaterMark:2})},ds=64*1024,{isFunction:mt}=C,Qu=(({Request:n,Response:t})=>({Request:n,Response:t}))(C.global),{ReadableStream:ps,TextEncoder:ms}=C.global,hs=(n,...t)=>{try{return!!n(...t)}catch{return!1}},Zu=n=>{n=C.merge.call({skipUndefined:!0},Qu,n);const{fetch:t,Request:e,Response:s}=n,a=t?mt(t):typeof fetch=="function",l=mt(e),r=mt(s);if(!a)return!1;const d=a&&mt(ps),y=a&&(typeof ms=="function"?(m=>S=>m.encode(S))(new ms):async m=>new Uint8Array(await new e(m).arrayBuffer())),u=l&&d&&hs(()=>{let m=!1;const S=new e(Re.origin,{body:new ps,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!S}),i=r&&d&&hs(()=>C.isReadableStream(new s("").body)),f={stream:i&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!f[m]&&(f[m]=(S,w)=>{let v=S&&S[m];if(v)return v.call(S);throw new ue(`Response type '${m}' is not supported`,ue.ERR_NOT_SUPPORT,w)})});const k=async m=>{if(m==null)return 0;if(C.isBlob(m))return m.size;if(C.isSpecCompliantForm(m))return(await new e(Re.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(C.isArrayBufferView(m)||C.isArrayBuffer(m))return m.byteLength;if(C.isURLSearchParams(m)&&(m=m+""),C.isString(m))return(await y(m)).byteLength},E=async(m,S)=>{const w=C.toFiniteNumber(m.getContentLength());return w??k(S)};return async m=>{let{url:S,method:w,data:v,signal:N,cancelToken:W,timeout:L,onDownloadProgress:b,onUploadProgress:P,responseType:U,headers:D,withCredentials:q="same-origin",fetchOptions:$}=Gs(m),I=t||fetch;U=U?(U+"").toLowerCase():"text";let T=Ku([N,W&&W.toAbortSignal()],L),O=null;const J=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let H;try{if(P&&u&&w!=="get"&&w!=="head"&&(H=await E(D,v))!==0){let de=new e(S,{method:"POST",body:v,duplex:"half"}),M;if(C.isFormData(v)&&(M=de.headers.get("content-type"))&&D.setContentType(M),de.body){const[V,G]=rs(H,bt(is(P)));v=us(de.body,ds,V,G)}}C.isString(q)||(q=q?"include":"omit");const X=l&&"credentials"in e.prototype,se={...$,signal:T,method:w.toUpperCase(),headers:D.normalize().toJSON(),body:v,duplex:"half",credentials:X?q:void 0};O=l&&new e(S,se);let Y=await(l?I(O,$):I(S,se));const ne=i&&(U==="stream"||U==="response");if(i&&(b||ne&&J)){const de={};["status","statusText","headers"].forEach(Z=>{de[Z]=Y[Z]});const M=C.toFiniteNumber(Y.headers.get("content-length")),[V,G]=b&&rs(M,bt(is(b),!0))||[];Y=new s(us(Y.body,ds,V,()=>{G&&G(),J&&J()}),de)}U=U||"text";let Pe=await f[C.findKey(f,U)||"text"](Y,m);return!ne&&J&&J(),await new Promise((de,M)=>{zs(de,M,{data:Pe,headers:Fe.from(Y.headers),status:Y.status,statusText:Y.statusText,config:m,request:O})})}catch(X){throw J&&J(),X&&X.name==="TypeError"&&/Load failed|fetch/i.test(X.message)?Object.assign(new ue("Network Error",ue.ERR_NETWORK,m,O),{cause:X.cause||X}):ue.from(X,X&&X.code,m,O)}}},ed=new Map,Ks=n=>{let t=n&&n.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let r=l.length,d=r,y,u,i=ed;for(;d--;)y=l[d],u=i.get(y),u===void 0&&i.set(y,u=d?new Map:Zu(t)),i=u;return u};Ks();const zt={http:gu,xhr:Gu,fetch:{get:Ks}};C.forEach(zt,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const fs=n=>`- ${n}`,td=n=>C.isFunction(n)||n===null||n===!1;function sd(n,t){n=C.isArray(n)?n:[n];const{length:e}=n;let s,a;const l={};for(let r=0;r<e;r++){s=n[r];let d;if(a=s,!td(s)&&(a=zt[(d=String(s)).toLowerCase()],a===void 0))throw new ue(`Unknown adapter '${d}'`);if(a&&(C.isFunction(a)||(a=a.get(t))))break;l[d||"#"+r]=a}if(!a){const r=Object.entries(l).map(([y,u])=>`adapter ${y} `+(u===!1?"is not supported by the environment":"is not available in the build"));let d=e?r.length>1?`since :
`+r.map(fs).join(`
`):" "+fs(r[0]):"as no adapter specified";throw new ue("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return a}const Js={getAdapter:sd,adapters:zt};function At(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new st(null,n)}function vs(n){return At(n),n.headers=Fe.from(n.headers),n.data=xt.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Js.getAdapter(n.adapter||ct.adapter,n)(n).then(function(s){return At(n),s.data=xt.call(n,n.transformResponse,s),s.headers=Fe.from(s.headers),s},function(s){return js(s)||(At(n),s&&s.response&&(s.response.data=xt.call(n,n.transformResponse,s.response),s.response.headers=Fe.from(s.response.headers))),Promise.reject(s)})}const Xs="1.13.2",Et={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{Et[n]=function(s){return typeof s===n||"a"+(t<1?"n ":" ")+n}});const gs={};Et.transitional=function(t,e,s){function a(l,r){return"[Axios v"+Xs+"] Transitional option '"+l+"'"+r+(s?". "+s:"")}return(l,r,d)=>{if(t===!1)throw new ue(a(r," has been removed"+(e?" in "+e:"")),ue.ERR_DEPRECATED);return e&&!gs[r]&&(gs[r]=!0,console.warn(a(r," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,r,d):!0}};Et.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function od(n,t,e){if(typeof n!="object")throw new ue("options must be an object",ue.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let a=s.length;for(;a-- >0;){const l=s[a],r=t[l];if(r){const d=n[l],y=d===void 0||r(d,l,n);if(y!==!0)throw new ue("option "+l+" must be "+y,ue.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ue("Unknown option "+l,ue.ERR_BAD_OPTION)}}const gt={assertOptions:od,validators:Et},Oe=gt.validators;let je=class{constructor(t){this.defaults=t||{},this.interceptors={request:new as,response:new as}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=We(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&gt.assertOptions(s,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),a!=null&&(C.isFunction(a)?e.paramsSerializer={serialize:a}:gt.assertOptions(a,{encode:Oe.function,serialize:Oe.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),gt.assertOptions(e,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=l&&C.merge(l.common,l[e.method]);l&&C.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),e.headers=Fe.concat(r,l);const d=[];let y=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(e)===!1||(y=y&&S.synchronous,d.unshift(S.fulfilled,S.rejected))});const u=[];this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let i,f=0,k;if(!y){const m=[vs.bind(this),void 0];for(m.unshift(...d),m.push(...u),k=m.length,i=Promise.resolve(e);f<k;)i=i.then(m[f++],m[f++]);return i}k=d.length;let E=e;for(;f<k;){const m=d[f++],S=d[f++];try{E=m(E)}catch(w){S.call(this,w);break}}try{i=vs.call(this,E)}catch(m){return Promise.reject(m)}for(f=0,k=u.length;f<k;)i=i.then(u[f++],u[f++]);return i}getUri(t){t=We(this.defaults,t);const e=Ws(t.baseURL,t.url,t.allowAbsoluteUrls);return Bs(e,t.params,t.paramsSerializer)}};C.forEach(["delete","get","head","options"],function(t){je.prototype[t]=function(e,s){return this.request(We(s||{},{method:t,url:e,data:(s||{}).data}))}});C.forEach(["post","put","patch"],function(t){function e(s){return function(l,r,d){return this.request(We(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:r}))}}je.prototype[t]=e(),je.prototype[t+"Form"]=e(!0)});let nd=class Ys{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const r=new Promise(d=>{s.subscribe(d),l=d}).then(a);return r.cancel=function(){s.unsubscribe(l)},r},t(function(l,r,d){s.reason||(s.reason=new st(l,r,d),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Ys(function(a){t=a}),cancel:t}}};function ad(n){return function(e){return n.apply(null,e)}}function ld(n){return C.isObject(n)&&n.isAxiosError===!0}const qt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(qt).forEach(([n,t])=>{qt[t]=n});function Qs(n){const t=new je(n),e=Is(je.prototype.request,t);return C.extend(e,je.prototype,t,{allOwnKeys:!0}),C.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Qs(We(n,a))},e}const Te=Qs(ct);Te.Axios=je;Te.CanceledError=st;Te.CancelToken=nd;Te.isCancel=js;Te.VERSION=Xs;Te.toFormData=Tt;Te.AxiosError=ue;Te.Cancel=Te.CanceledError;Te.all=function(t){return Promise.all(t)};Te.spread=ad;Te.isAxiosError=ld;Te.mergeConfig=We;Te.AxiosHeaders=Fe;Te.formToJSON=n=>Vs(C.isHTMLForm(n)?new FormData(n):n);Te.getAdapter=Js.getAdapter;Te.HttpStatusCode=qt;Te.default=Te;const{Axios:Qf,AxiosError:Zf,CanceledError:ev,isCancel:tv,CancelToken:sv,VERSION:ov,all:nv,Cancel:av,isAxiosError:lv,spread:rv,toFormData:iv,AxiosHeaders:cv,HttpStatusCode:uv,formToJSON:dv,getAdapter:pv,mergeConfig:mv}=Te;class rd{static async getAvailableModels(){try{return(await Te({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const id={class:"assigned-tools"},cd={class:"section-header"},ud=["title"],dd={class:"tool-info"},pd={class:"tool-name"},md=["title"],hd={key:0,class:"no-tools"},fd=Ee({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:t}){const e=n,s=t,a=at(),l=re(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const r=re(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(u=>l.value.some(i=>i.key===u)):[]);be(r,u=>{if(!Array.isArray(e.selectedToolIds))return;const i=e.selectedToolIds.length;u.length!==i&&s("tools-filtered",u)},{immediate:!0});const d=u=>{const i=l.value.find(k=>k.key===u);return i?`${i.serviceGroup||"Ungrouped"}.${i.name}`:u},y=u=>{const i=l.value.find(f=>f.key===u);return i?i.description:""};return(u,i)=>(h(),g("div",id,[o("div",cd,[o("span",null,c(u.title)+" ("+c(r.value.length)+")",1),u.showAddButton?(h(),g("button",{key:0,class:"action-btn small",onClick:i[0]||(i[0]=f=>u.$emit("add-tools"))},[x(p(F),{icon:"carbon:add"}),me(" "+c(u.addButtonText),1)])):B("",!0)]),o("div",{class:ge(["tools-grid",{"grid-layout":u.useGridLayout,"has-more-items":u.useGridLayout&&r.value.length>2}])},[(h(!0),g(fe,null,ye(r.value,f=>(h(),g("div",{key:f,class:"tool-item assigned",title:y(f)},[o("div",dd,[o("span",pd,c(d(f)),1),o("span",{class:"tool-desc",title:y(f)},c(y(f)),9,md)])],8,ud))),128)),r.value.length===0?(h(),g("div",hd,[x(p(F),{icon:"carbon:tool-box"}),o("span",null,c(u.emptyText),1)])):B("",!0)],2)]))}}),vd=ke(fd,[["__scopeId","data-v-62354a05"]]),gd={class:"tool-selection-content"},yd={class:"tool-controls"},bd={class:"search-container"},_d=["placeholder"],wd={class:"sort-container"},$d={value:"group"},Sd={value:"name"},Pd={value:"enabled"},Td={class:"tool-summary"},Ed={class:"summary-text"},kd={key:0,class:"tool-groups"},Cd=["onClick"],Id={class:"group-title-area"},Rd={class:"group-name"},xd={class:"group-count"},Ad={class:"group-enable-all"},Fd=["checked","onChange","data-group"],Md={class:"enable-label"},Dd={class:"tool-info"},Nd={class:"tool-selection-name"},Ud={key:0,class:"tool-selection-desc"},Ld={class:"tool-actions"},Od=["checked","onChange"],qd={key:1,class:"empty-state"},Bd=Ee({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:t}){const e=n,s=t,a=at(),l=re(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),be(()=>e.modelValue,$=>{$&&!a.isLoading.value&&a.loadAvailableTools()});const r=re({get:()=>e.modelValue,set:$=>s("update:modelValue",$)}),d=A(""),y=A("group"),u=A(new Set),i=A([]),f=A(null),k=($,I)=>{const T=document.querySelector(`input[data-group="${$}"]`);T&&(T.indeterminate=b(I))};be(()=>e.selectedToolIds,$=>{i.value=[...$]},{immediate:!0});const E=re(()=>{let $=l.value.filter(I=>I.key);if($=$.filter(I=>I.selectable===!0),d.value){const I=d.value.toLowerCase();$=$.filter(T=>T.name.toLowerCase().includes(I)||T.description.toLowerCase().includes(I)||T.serviceGroup.toLowerCase().includes(I))}switch(y.value){case"name":$=[...$].sort((I,T)=>I.name.localeCompare(T.name));break;case"enabled":$=[...$].sort((I,T)=>{const O=i.value.includes(I.key),J=i.value.includes(T.key);return O&&!J?-1:!O&&J?1:I.name.localeCompare(T.name)});break;case"group":default:$=[...$].sort((I,T)=>{const O=I.serviceGroup||"Ungrouped",J=T.serviceGroup||"Ungrouped";return O!==J?O.localeCompare(J):I.name.localeCompare(T.name)});break}return $}),m=re(()=>{const $=new Map;return l.value.filter(T=>T.key&&T.selectable===!0).forEach(T=>{const O=T.serviceGroup||"Ungrouped";$.has(O)||$.set(O,[]),$.get(O).push(T)}),$}),S=re(()=>{const $=new Map;return E.value.forEach(I=>{const T=I.serviceGroup||"Ungrouped";$.has(T)||$.set(T,[]),$.get(T).push(I)}),new Map([...$.entries()].sort())}),w=re(()=>E.value.length);be([i,S],()=>{xe(()=>{for(const[$,I]of S.value)k($,I)})},{flush:"post",deep:!1});const v=$=>i.value.includes($),N=($,I)=>{I.stopPropagation();const O=I.target.checked;if(!$){console.error("toolKey is undefined, cannot proceed");return}O?i.value.includes($)||(i.value=[...i.value,$]):i.value=i.value.filter(J=>J!==$)},W=$=>$.filter(I=>i.value.includes(I.key)),L=$=>$.length>0&&$.every(I=>i.value.includes(I.key)),b=$=>{const I=W($).length;return I>0&&I<$.length},P=($,I)=>{I.stopPropagation();const O=I.target.checked,J=$.map(H=>H.key);if(O){const H=[...i.value];J.forEach(X=>{H.includes(X)||H.push(X)}),i.value=H}else i.value=i.value.filter(H=>!J.includes(H))},U=$=>{u.value.has($)?u.value.delete($):u.value.add($)},D=()=>{s("confirm",[...i.value]),s("update:modelValue",!1)},q=()=>{i.value=[...e.selectedToolIds],s("update:modelValue",!1)};return be(d,$=>{const I=$.trim().toLowerCase();if(I){f.value===null&&(f.value=new Set(u.value));for(const[T,O]of m.value)O.some(H=>H.name.toLowerCase().includes(I)||H.description&&H.description.toLowerCase().includes(I)||H.serviceGroup&&H.serviceGroup.toLowerCase().includes(I))&&u.value.delete(T)}else f.value!==null&&(u.value=new Set(f.value),f.value=null)}),be(r,$=>{if($){u.value.clear(),f.value=null;const I=Array.from(S.value.keys());I.length>1&&I.slice(1).forEach(T=>{u.value.add(T)})}}),($,I)=>(h(),Se(Ss,{modelValue:r.value,"onUpdate:modelValue":[I[4]||(I[4]=T=>r.value=T),q],title:$.$t("toolSelection.title"),onConfirm:D},{default:ze(()=>[o("div",gd,[o("div",yd,[o("div",bd,[we(o("input",{"onUpdate:modelValue":I[0]||(I[0]=T=>d.value=T),type:"text",class:"search-input",placeholder:$.$t("toolSelection.searchPlaceholder")},null,8,_d),[[Ce,d.value]])]),o("div",wd,[we(o("select",{"onUpdate:modelValue":I[1]||(I[1]=T=>y.value=T),class:"sort-select"},[o("option",$d,c($.$t("toolSelection.sortByGroup")),1),o("option",Sd,c($.$t("toolSelection.sortByName")),1),o("option",Pd,c($.$t("toolSelection.sortByStatus")),1)],512),[[Bt,y.value]])])]),o("div",Td,[o("span",Ed,c($.$t("toolSelection.summary",{groups:S.value.size,tools:w.value,selected:i.value.length})),1)]),S.value.size>0?(h(),g("div",kd,[(h(!0),g(fe,null,ye(S.value,([T,O])=>(h(),g("div",{key:T,class:"tool-group"},[o("div",{class:ge(["tool-group-header",{collapsed:u.value.has(T)}]),onClick:J=>U(T)},[o("div",Id,[x(p(F),{icon:u.value.has(T)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),x(p(F),{icon:"carbon:folder",class:"group-icon"}),o("span",Rd,c(T),1),o("span",xd," ("+c(W(O).length)+"/"+c(O.length)+") ",1)]),o("div",{class:"group-actions",onClick:I[2]||(I[2]=$e(()=>{},["stop"]))},[o("label",Ad,[o("input",{type:"checkbox",class:"group-enable-checkbox",checked:L(O),onChange:J=>P(O,J),"data-group":T},null,40,Fd),o("span",Md,c($.$t("toolSelection.enableAll")),1)])])],10,Cd),o("div",{class:ge(["tool-group-content",{collapsed:u.value.has(T)}])},[(h(!0),g(fe,null,ye(O,J=>(h(),g("div",{key:J.key,class:"tool-selection-item"},[o("div",Dd,[o("div",Nd,c(J.name),1),J.description?(h(),g("div",Ud,c(J.description),1)):B("",!0)]),o("div",Ld,[o("label",{class:"tool-enable-switch",onClick:I[3]||(I[3]=$e(()=>{},["stop"]))},[o("input",{type:"checkbox",class:"tool-enable-checkbox",checked:v(J.key),onChange:H=>N(J.key,H)},null,40,Od),I[5]||(I[5]=o("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),g("div",qd,[x(p(F),{icon:"carbon:tools",class:"empty-icon"}),o("p",null,c($.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Hd=ke(Bd,[["__scopeId","data-v-627b463f"]]),Vd={class:"config-section"},jd={class:"section-header"},zd={class:"visual-editor"},Wd={class:"plan-basic-info"},Gd={class:"form-row"},Kd={class:"form-label"},Jd=["placeholder"],Xd={key:0,class:"field-error-message"},Yd={class:"form-row"},Qd={class:"form-label"},Zd={class:"service-group-autocomplete"},ep=["placeholder"],tp={key:0,class:"service-group-dropdown"},sp=["onMousedown"],op={class:"field-description"},np={class:"steps-section"},ap={class:"steps-container"},lp={class:"step-content"},rp={class:"form-row"},ip={class:"form-label"},cp=["value","onInput","placeholder"],up={class:"form-row"},dp={class:"form-label"},pp=["value","onInput","placeholder"],mp={key:0,class:"preview-section"},hp={class:"preview-label"},fp={class:"preview-content"},vp={class:"preview-text"},gp={class:"preview-table-header"},yp={class:"form-row"},bp={class:"form-label"},_p={class:"model-selector-wrapper"},wp={class:"model-input-wrapper"},$p=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Sp={key:0,class:"dropdown-item disabled"},Pp={key:1,class:"dropdown-item disabled error"},Tp={key:2,class:"dropdown-item disabled"},Ep=["onClick","onMouseenter"],kp=["onClick","onMouseenter"],Cp=["title"],Ip={key:0,class:"error-message"},Rp={class:"form-row"},xp={key:0,class:"empty-steps"},Ap={class:"empty-text"},Fp={key:0,class:"json-preview"},Mp={class:"preview-header"},Dp={class:"form-label"},Np={class:"json-code"},Up={class:"editor-footer"},Lp={class:"section-actions"},Op=["disabled","title"],qp=["disabled","title"],Bp=["disabled","title"],Hp=["disabled"],Vp={class:"modal-header"},jp={class:"modal-body"},zp={class:"form-row"},Wp={class:"form-label"},Gp=["placeholder"],Kp={class:"modal-footer"},Jp=["disabled"],Xp=Ee({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=wt(),a=Ge(),l=He({title:"",steps:[]}),r=A(!1),d=A(!1),y=A([]),u=A(!1),i=A(""),f=re(()=>a.generateJsonString()),k=A(!1);let E=null;const m=()=>{a.isUserUpdating.value=!0,E&&clearTimeout(E),E=setTimeout(()=>{a.isUserUpdating.value=!1,E=null},500)},S=()=>{if(a.isUserUpdating.value){console.log("[JsonEditorV2] syncDisplayDataFromConfig skipped: isUserUpdating is true");return}console.log("[JsonEditorV2] syncDisplayDataFromConfig called"),k.value=!0;try{const _=a.getConfig();console.log("[JsonEditorV2] Syncing displayData with config:",{title:_.title,stepsCount:_.steps?.length||0,serviceGroup:_.serviceGroup}),(_.title?.trim()||!l.title?.trim())&&(l.title=_.title||""),l.steps=(_.steps||[]).map(K=>({...K})),i.value=_.serviceGroup||"",console.log("[JsonEditorV2] displayData synced:",{title:l.title,stepsCount:l.steps.length,serviceGroup:i.value})}finally{setTimeout(()=>{k.value=!1},0)}},w=()=>{k.value=!0;try{a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(pe.hasTaskRequirementModified=!0)}finally{setTimeout(()=>{k.value=!1},0)}},v=()=>{r.value=!r.value},N=()=>{r.value=!1},W=()=>{try{E&&(clearTimeout(E),E=null),a.isUserUpdating.value=!1,a.rollbackVersion()}catch(_){console.error("Error during rollback operation:",_),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},L=()=>{try{E&&(clearTimeout(E),E=null),a.isUserUpdating.value=!1,a.restoreVersion()}catch(_){console.error("Error during restore operation:",_),s.error(e("sidebar.restoreFailed")||"Restore failed")}},b=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}E&&(clearTimeout(E),E=null),a.isUserUpdating.value=!1,w();const _=a.validate();if(!_.isValid){s.error(`Invalid format, please correct and save.
Errors: `+_.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const ce=a.generateJsonString().trim();a.updateVersionsAfterSave(ce);const ve=a.planVersions.value.length;pe.hasTaskRequirementModified=!1,await pe.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:ve}))}catch(_){console.error("Failed to save plan modifications:",_);const K=_ instanceof Error?_.message:e("sidebar.saveFailed");throw s.error(K),_}},P=A(""),U=(_,K)=>{m();const Q=l.steps[K];Q&&(Q.stepRequirement=_.target.value),Xt(_)},D=(_,K)=>{m();const Q=l.steps[K];Q&&(Q.terminateColumns=_.target.value),Xt(_)},q=()=>{const _={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push(_),a.setSteps(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},$=A([]),I=A(!1),T=A(""),O=A(new Map),J=A(new Set),H=A(new Map),X=_=>O.value.get(_)??"",se=(_,K)=>{O.value.set(_,K)},Y=_=>{const K=X(_);if(!K.trim())return $.value;const Q=K.toLowerCase().trim();return $.value.filter(ce=>ce.value.toLowerCase().includes(Q)||ce.label.toLowerCase().includes(Q))},ne=_=>{const K=l.steps[_],Q=X(_);return J.value.has(_)&&Q!==""?Q:K.modelName??""},Pe=_=>I.value||T.value||l.steps[_].modelName?"":e("sidebar.modelNameDescription")||"",de=_=>J.value.has(_),M=_=>{I.value||J.value.add(_)},V=_=>{J.value.delete(_),H.value.set(_,-1);const K=l.steps[_];se(_,K.modelName??"")},G=_=>{de(_)?V(_):M(_)},Z=(_,K)=>{m();const Q=l.steps[K];Q.modelName=_,se(K,_),V(K)},oe=(_,K)=>{m();const Q=_.target;se(K,Q.value),M(K)},ie=_=>H.value.get(_)??-1,he=(_,K)=>{H.value.set(_,K)},te=_=>{const K=ie(_),Q=Y(_);K>=0&&K<Q.length?Z(Q[K].value,_):K===-1?Z("",_):Q.length>0?Z(Q[0].value,_):l.steps[_].modelName||Z("",_)},j=_=>{if(!de(_)){M(_),he(_,0);return}const Q=Y(_).length+1,ce=ie(_),ve=Math.min(ce+1,Q-1);he(_,ve)},R=_=>{if(!de(_)){M(_);const ce=Y(_);he(_,ce.length);return}const K=ie(_),Q=Math.max(K-1,-1);he(_,Q)},z=_=>{_.target.closest(".model-selector")||J.value.clear()};be(()=>l.steps,_=>{_.forEach((K,Q)=>{O.value.has(Q)||se(Q,K.modelName??"")})},{deep:!0,immediate:!0});const ee=A(!1),le=A(-1),ae=async()=>{if(!I.value){I.value=!0,T.value="";try{const _=await rd.getAvailableModels();$.value=_.options}catch(_){console.error("Failed to load models:",_),T.value=_ instanceof Error?_.message:"Failed to load models",$.value=[]}finally{I.value=!1}}},_e=_=>{le.value=_,ee.value=!0},Ke=_=>{m(),le.value>=0&&le.value<l.steps.length&&(l.steps[le.value].selectedToolKeys=[..._]),ee.value=!1,le.value=-1},eo=(_,K)=>{m(),_>=0&&_<l.steps.length&&(l.steps[_].selectedToolKeys=[...K])},ut=A(!1),qe=A(""),Be=A(!1),to=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}qe.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),ut.value=!0},dt=()=>{ut.value=!1,qe.value="",Be.value=!1},so=_=>{_.target===_.currentTarget&&dt()},Gt=async()=>{if(!qe.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}Be.value=!0;try{const _=a.getConfig(),K=`planTemplate-${Date.now()}`,{toolConfig:Q,...ce}=_,ve={...ce,title:qe.value.trim(),planTemplateId:K};console.log("[JsonEditorV2] Copying plan without toolConfig:",ve),(await Qt.createOrUpdatePlanTemplateWithTool(ve)).success?(s.success(e("sidebar.copyPlanSuccess",{title:qe.value.trim()})),await pe.loadPlanTemplateList(),dt()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch(_){if(console.error("[JsonEditorV2] Error copying plan:",_),_ instanceof Error&&_.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const K=_ instanceof Error?_.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:K}))}}finally{Be.value=!1}};be(()=>l.title,_=>{_?.trim()?P.value="":P.value="Title is required field"},{immediate:!0});const Kt=()=>{const _=a.getServiceGroup()||"";i.value=_};be(()=>a.config,()=>{a.needsFullRefresh.value&&!k.value&&!a.isUserUpdating.value&&S()},{deep:!0,immediate:!0}),be(()=>a.currentPlanTemplateId.value,(_,K)=>{console.log("[JsonEditorV2] currentPlanTemplateId changed:",{oldId:K,newId:_}),K!=null&&_!==K&&(O.value.clear(),J.value.clear(),H.value.clear(),ee.value=!1,ut.value=!1,r.value=!1,le.value=-1,qe.value="",Be.value=!1),console.log("[JsonEditorV2] Calling syncDisplayDataFromConfig from currentPlanTemplateId watch"),S(),Kt()},{immediate:!0}),be(()=>i.value,_=>{k.value=!0;try{a.setServiceGroup(_)}finally{setTimeout(()=>{k.value=!1},0)}});const oo=async()=>{if(!u.value){u.value=!0;try{const _=new Set;try{(await Cs.getAvailableTools()).forEach(Q=>{Q.serviceGroup&&_.add(Q.serviceGroup)})}catch(K){console.error("[JsonEditorV2] Failed to load service groups from tools:",K)}try{(await Qt.getAllPlanTemplateConfigVOs()).forEach(Q=>{Q.serviceGroup&&_.add(Q.serviceGroup)})}catch(K){console.error("[JsonEditorV2] Failed to load service groups from plan templates:",K)}y.value=Array.from(_).sort()}catch(_){console.error("[JsonEditorV2] Failed to load service groups:",_),y.value=[]}finally{u.value=!1}}},Jt=re(()=>{const _=i.value.trim();if(!_)return y.value;const K=_.toLowerCase();return y.value.filter(Q=>Q.toLowerCase().includes(K))}),no=()=>{m()},ao=()=>{d.value=!0},lo=()=>{m(),ao()},ro=()=>{setTimeout(()=>{d.value=!1},200)},io=_=>{i.value=_,d.value=!1};Me(()=>{S(),Kt(),oo(),ae(),document.addEventListener("click",z)}),Ue(()=>{document.removeEventListener("click",z),E&&(clearTimeout(E),E=null)}),t({save:b});const Xt=_=>{const K=_.target;K.style.height="auto";const Q=20,ce=Math.ceil(K.scrollHeight/Q),ve=4,Je=12,pt=Math.max(ve,Math.min(Je,ce)),uo=pt*Q;K.style.height=`${uo}px`,K.rows=pt,ce>Je?K.style.overflowY="auto":K.style.overflowY="hidden"},co=_=>{if(!_.trim())return"";const K=_.split(",").map(Q=>Q.trim()).filter(Q=>Q.length>0);return K.length===0?"":`|${K.join("|")}|`};return(_,K)=>(h(),g("div",Vd,[o("div",jd,[x(p(F),{icon:"carbon:code",width:"16"}),o("span",null,c(_.$t("sidebar.dynamicAgentPlan")),1)]),o("div",zd,[o("div",Wd,[o("div",Gd,[o("label",Kd,c(_.$t("sidebar.title")),1),we(o("input",{"onUpdate:modelValue":K[0]||(K[0]=Q=>l.title=Q),type:"text",class:ge(["form-input",{error:P.value}]),placeholder:_.$t("sidebar.titlePlaceholder"),onInput:no},null,42,Jd),[[Ce,l.title]]),P.value?(h(),g("div",Xd,[x(p(F),{icon:"carbon:warning",width:"12"}),me(" "+c(P.value),1)])):B("",!0)]),o("div",Yd,[o("label",Qd,c(_.$t("mcpService.serviceGroup")),1),o("div",Zd,[we(o("input",{type:"text","onUpdate:modelValue":K[1]||(K[1]=Q=>i.value=Q),onInput:lo,onFocus:K[2]||(K[2]=Q=>d.value=!0),onBlur:ro,placeholder:_.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,ep),[[Ce,i.value]]),d.value&&Jt.value.length>0?(h(),g("div",tp,[(h(!0),g(fe,null,ye(Jt.value,Q=>(h(),g("div",{key:Q,class:"service-group-option",onMousedown:ce=>io(Q)},c(Q),41,sp))),128))])):B("",!0)]),o("div",op,c(_.$t("mcpService.serviceGroupDescription")),1)])]),o("div",np,[o("div",ap,[(h(!0),g(fe,null,ye(l.steps,(Q,ce)=>(h(),g("div",{key:ce,class:"step-item"},[o("div",lp,[o("div",rp,[o("label",ip,c(_.$t("sidebar.stepRequirement")),1),o("textarea",{value:Q.stepRequirement||"",onInput:ve=>U(ve,ce),class:"form-textarea auto-resize",placeholder:_.$t("sidebar.stepRequirementPlaceholder"),rows:"8"},null,40,cp)]),o("div",up,[o("label",dp,c(_.$t("sidebar.terminateColumns")),1),o("textarea",{value:Q.terminateColumns||"",onInput:ve=>D(ve,ce),class:"form-textarea auto-resize",placeholder:_.$t("sidebar.terminateColumnsPlaceholder"),rows:"1"},null,40,pp),Q.terminateColumns&&Q.terminateColumns.trim()?(h(),g("div",mp,[o("div",hp,c(_.$t("sidebar.preview"))+":",1),o("div",fp,[o("div",vp,[me(c(_.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),o("span",gp,c(co(Q.terminateColumns)),1)])])])):B("",!0)]),o("div",yp,[o("label",bp,c(_.$t("sidebar.modelName")),1),o("div",_p,[o("div",{class:ge(["model-selector",{"is-open":de(ce),"is-disabled":I.value}])},[o("div",wp,[o("input",{value:ne(ce),type:"text",class:"form-input model-search-input",placeholder:Pe(ce),disabled:I.value,onClick:$e(ve=>M(ce),["stop"]),onFocus:ve=>M(ce),onInput:ve=>oe(ve,ce),onKeydown:[ot(ve=>V(ce),["escape"]),ot($e(ve=>te(ce),["prevent"]),["enter"]),ot($e(ve=>j(ce),["prevent"]),["down"]),ot($e(ve=>R(ce),["prevent"]),["up"])]},null,40,$p),x(p(F),{icon:"carbon:chevron-down",width:"14",class:ge(["dropdown-arrow",{"is-open":de(ce)}]),onClick:$e(ve=>G(ce),["stop"])},null,8,["class","onClick"])]),de(ce)?(h(),g("div",{key:0,class:"model-dropdown",onClick:K[3]||(K[3]=$e(()=>{},["stop"]))},[I.value?(h(),g("div",Sp,c(_.$t("sidebar.loading")),1)):T.value?(h(),g("div",Pp,c(_.$t("sidebar.modelLoadError")),1)):Y(ce).length===0?(h(),g("div",Tp,c(_.$t("sidebar.noModelsFound")),1)):B("",!0),(h(!0),g(fe,null,ye(Y(ce),(ve,Je)=>(h(),g("div",{key:ve.value,class:ge(["dropdown-item",{"is-selected":Q.modelName===ve.value,"is-highlighted":ie(ce)===Je}]),onClick:pt=>Z(ve.value,ce),onMouseenter:pt=>he(ce,Je)},[me(c(ve.value)+" ",1),Q.modelName===ve.value?(h(),Se(p(F),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):B("",!0)],42,Ep))),128)),o("div",{class:ge(["dropdown-item",{"is-selected":!Q.modelName,"is-highlighted":ie(ce)===-1}]),onClick:ve=>Z("",ce),onMouseenter:ve=>he(ce,-1)},[me(c(_.$t("sidebar.noModelSelected"))+" ",1),Q.modelName?B("",!0):(h(),Se(p(F),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,kp)])):B("",!0)],2),T.value?(h(),g("button",{key:0,onClick:ae,class:"btn btn-sm btn-danger",title:_.$t("sidebar.retryLoadModels")},[x(p(F),{icon:"carbon:warning",width:"14"}),me(" "+c(_.$t("sidebar.retry")),1)],8,Cp)):B("",!0)]),T.value?(h(),g("div",Ip,[x(p(F),{icon:"carbon:warning",width:"12"}),me(" "+c(T.value),1)])):B("",!0)]),o("div",Rp,[x(vd,{title:_.$t("sidebar.selectedTools"),"selected-tool-ids":Q.selectedToolKeys||[],"add-button-text":_.$t("sidebar.addRemoveTools"),"empty-text":_.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ve=>_e(ce),onToolsFiltered:ve=>eo(ce,ve)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),g("div",xp,[x(p(F),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),o("p",Ap,c(_.$t("sidebar.noSteps")),1),o("button",{class:"btn btn-primary btn-add-step",onClick:q},[x(p(F),{icon:"carbon:add",width:"16"}),me(" "+c(_.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),r.value?(h(),g("div",Fp,[o("div",Mp,[o("label",Dp,c(_.$t("sidebar.jsonPreview")),1),o("button",{onClick:N,class:"btn btn-xs"},[x(p(F),{icon:"carbon:close",width:"12"})])]),o("pre",Np,c(f.value),1)])):B("",!0),o("div",Up,[o("button",{onClick:v,class:"btn btn-sm btn-secondary"},[x(p(F),{icon:"carbon:code",width:"14"}),me(" "+c(r.value?_.$t("sidebar.hideJson"):_.$t("sidebar.showJson")),1)]),o("div",Lp,[o("button",{class:"btn btn-sm",onClick:to,disabled:_.isGenerating||_.isExecuting,title:_.$t("sidebar.copyPlan")},[x(p(F),{icon:"carbon:copy",width:"14"}),me(" "+c(_.$t("sidebar.copyPlan")),1)],8,Op),o("button",{class:"btn btn-sm",onClick:W,disabled:!p(a).canRollback.value,title:_.$t("sidebar.rollback")},[x(p(F),{icon:"carbon:undo",width:"14"})],8,qp),o("button",{class:"btn btn-sm",onClick:L,disabled:!p(a).canRestore.value,title:_.$t("sidebar.restore")},[x(p(F),{icon:"carbon:redo",width:"14"})],8,Bp),o("button",{class:"btn btn-primary",onClick:b,disabled:_.isGenerating||_.isExecuting},[x(p(F),{icon:"carbon:save",width:"14"}),K[7]||(K[7]=me(" Save "))],8,Hp)])])]),x(Hd,{modelValue:ee.value,"onUpdate:modelValue":K[4]||(K[4]=Q=>ee.value=Q),"selected-tool-ids":le.value>=0?l.steps[le.value]?.selectedToolKeys||[]:[],onConfirm:Ke},null,8,["modelValue","selected-tool-ids"]),ut.value?(h(),g("div",{key:0,class:"modal-overlay",onMousedown:so},[o("div",{class:"modal-content",onMousedown:K[6]||(K[6]=$e(()=>{},["stop"]))},[o("div",Vp,[o("h3",null,c(_.$t("sidebar.copyPlan")),1),o("button",{class:"close-btn",onClick:dt},[x(p(F),{icon:"carbon:close",width:"16"})])]),o("div",jp,[o("div",zp,[o("label",Wp,c(_.$t("sidebar.newPlanTitle")),1),we(o("input",{"onUpdate:modelValue":K[5]||(K[5]=Q=>qe.value=Q),type:"text",class:"form-input",placeholder:_.$t("sidebar.enterNewPlanTitle"),onKeyup:ot(Gt,["enter"])},null,40,Gp),[[Ce,qe.value]])])]),o("div",Kp,[o("button",{class:"btn btn-secondary",onClick:dt},c(_.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:Gt,disabled:!qe.value.trim()||Be.value},[Be.value?(h(),Se(p(F),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):B("",!0),me(" "+c(Be.value?_.$t("sidebar.copying"):_.$t("sidebar.copyPlan")),1)],8,Jp)])],32)],32)):B("",!0)]))}}),Yp=ke(Xp,[["__scopeId","data-v-91127bd0"]]),Qp="/api/executor";async function Zs(n){try{const t=await fetch(`${Qp}/agent-execution/${n}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,t),null}}async function Zp(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Zs(n)}function em(){const n=et(),t=Ze(),e=A(null),s=A(null),a=A("config"),l=re(()=>n.activeRootPlanId.value),r=v=>{if(!v)return null;for(const[N,W]of t.planExecutionRecords.entries())if((W.rootPlanId||W.currentPlanId)&&W.agentExecutionSequence)for(const b of W.agentExecutionSequence){if(b.stepId===v){const P=W.rootPlanId||W.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:v,rootPlanId:P,planId:N}),P||null}if(b.subPlanExecutionRecords)for(const P of b.subPlanExecutionRecords){const U=d(P,v);if(U)return U}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",v),null},d=(v,N)=>{if(!v||!v.agentExecutionSequence)return null;for(const W of v.agentExecutionSequence){if(W.stepId===N)return v.rootPlanId||v.currentPlanId||null;if(W.subPlanExecutionRecords)for(const L of W.subPlanExecutionRecords){const b=d(L,N);if(b)return b}}return null},y=re(()=>s.value||l.value),u=re(()=>!y.value),i=async v=>{if(console.log("[useRightPanel] Step selected:",{stepId:v}),!v){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}k("details"),console.log("[useRightPanel] Switched to details tab");try{const N=r(v);N?(s.value=N,console.log("[useRightPanel] Set selectedRootPlanId to:",N)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const W=await Zs(v);if(!W){console.warn("[useRightPanel] Agent execution detail not found for stepId:",v),e.value=null,s.value=null;return}const L={stepId:v,title:W.agentName??`Step ${v}`,description:W.agentDescription??"",agentExecution:W,completed:W.status==="FINISHED",current:W.status==="RUNNING"};e.value=L,console.log("[useRightPanel] Step details updated:",L),await xe(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(N){console.error("[useRightPanel] Error fetching step details:",N),e.value=null,s.value=null}},f=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const v=await Zp(e.value.stepId);v&&(e.value.agentExecution=v,e.value.completed=v.status==="FINISHED",e.value.current=v.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(v){console.error("[useRightPanel] Error refreshing step:",v)}},k=v=>{a.value=v,console.log("[useRightPanel] Active tab set to:",v)},E=v=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",v)},m=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},S=v=>{if(v===null||typeof v>"u"||v==="")return"N/A";if(typeof v=="object"&&v!==null)try{return JSON.stringify(v,null,2)}catch{return String(v)}if(typeof v=="string"){const N=v.trim();if(N==="")return"N/A";try{const W=JSON.parse(N);return JSON.stringify(W,null,2)}catch{return N}}return String(v)},w=()=>{e.value=null,s.value=null,a.value="config",console.log("[useRightPanel] State reset")};return{selectedStep:Ne(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:y,shouldShowNoTaskMessage:u,handleStepSelected:i,refreshCurrentStep:f,setActiveTab:k,updateDisplayedPlanProgress:E,clearSelectedStep:m,formatJson:S,reset:w}}let Ft=null;function Wt(){return Ft||(Ft=em()),Ft}const tm={class:"right-panel"},sm={class:"preview-header"},om={class:"preview-tabs"},nm={class:"preview-content"},am={key:0,class:"config-tab-content"},lm={key:0,class:"config-container"},rm={class:"template-info-header"},im={class:"template-info"},cm={class:"template-id"},um={key:1,class:"no-template-selected"},dm={class:"action-buttons"},pm=["title"],mm={class:"import-description"},hm={href:"https://github.com/Lynxe-public/Lynxe-public-prompts",target:"_blank",rel:"noopener noreferrer",class:"prompt-library-link"},fm={key:1,class:"step-details"},vm={key:0,class:"step-info"},gm={key:0,class:"agent-info"},ym={class:"info-item"},bm={class:"label"},_m=["title"],wm={class:"info-item"},$m={class:"label"},Sm={class:"value"},Pm={class:"execution-status"},Tm={class:"status-item"},Em={class:"status-text"},km={key:0},Cm={key:0,class:"think-act-steps"},Im={class:"steps-container"},Rm={class:"step-header"},xm={class:"step-number"},Am={class:"think-section"},Fm={class:"think-content"},Mm={class:"input"},Dm={class:"label-row"},Nm={class:"label"},Um={class:"label-actions"},Lm=["onClick","title"],Om={class:"char-count-badge"},qm={class:"pre-container"},Bm={class:"output"},Hm={class:"label-row"},Vm={class:"label"},jm={class:"label-actions"},zm=["onClick","title"],Wm={class:"char-count-badge"},Gm={class:"pre-container"},Km={key:0,class:"action-section"},Jm={class:"action-content"},Xm={class:"tool-info"},Ym={class:"label"},Qm={class:"value"},Zm={class:"input"},eh={class:"label"},th={class:"output"},sh={class:"label"},oh={key:0,class:"no-tools"},nh={key:0,class:"sub-plan-section"},ah={class:"sub-plan-content"},lh={class:"sub-plan-header"},rh={class:"sub-plan-info"},ih={class:"label"},ch={class:"value"},uh={key:0,class:"sub-plan-info"},dh={class:"label"},ph={class:"value"},mh={class:"sub-plan-status"},hh={class:"status-text"},fh={key:0,class:"no-steps-message"},vh={key:1,class:"no-execution-message"},gh={class:"step-basic-info"},yh={class:"info-item"},bh={class:"label"},_h={class:"value"},wh={key:0,class:"info-item"},$h={class:"label"},Sh={class:"value"},Ph={class:"info-item"},Th={class:"label"},Eh={class:"no-execution-hint"},kh={key:2,class:"execution-indicator"},Ch={class:"execution-text"},Ih={key:1,class:"no-selection"},Rh=["title"],xh={key:2,class:"file-browser-container"},Ah={key:1,class:"no-plan-message"},Fh={class:"message-content"},Mh={class:"tips"},Dh=Ee({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:t}){const e=n,{t:s}=De(),a=wt(),l=async H=>{if(!H){a.error(s("rightPanel.copyFailed")||"Failed to copy");return}try{await navigator.clipboard.writeText(H),a.success(s("rightPanel.copySuccess")||"Copied to clipboard")}catch(X){console.error("Failed to copy to clipboard:",X),a.error(s("rightPanel.copyFailed")||"Failed to copy")}},r=Wt(),d=Ge(),y=at(),{handleImport:u}=bo(),i=A(),f=A(!1),k=A(!0),E=A(!0),m=re(()=>r.selectedStep.value),S=re({get:()=>r.activeTab.value,set:H=>r.setActiveTab(H)}),w=re(()=>r.fileBrowserPlanId.value),v=re(()=>r.shouldShowNoTaskMessage.value),N=re(()=>m.value?m.value.completed?s("rightPanel.status.completed"):m.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),W=async()=>{try{const H=d.getPlanType()||"dynamic_agent";await pe.createNewTemplate(H);const X=d.selectedTemplate.value;X&&(d.reset(),d.setPlanType(X.planType||"dynamic_agent"),X.planTemplateId&&d.setPlanTemplateId(X.planTemplateId),d.setTitle(X.title||"")),console.log("[RightPanel] ðŸ”„ Reloading available tools for new template"),await y.loadAvailableTools()}catch(H){console.error("[RightPanel] Failed to create new plan:",H);const X=H instanceof Error?H.message:s("rightPanel.createPlanFailed");a.error(X)}},L=async H=>{await u(H,{onSuccess:async X=>{const se=s("rightPanel.importSuccess",{total:X.total,success:X.successCount,failed:X.failureCount});a.success(se)},onError:X=>{const se=X instanceof Error?X.message:s("rightPanel.importFailed");a.error(se)},onReload:async()=>{await pe.loadPlanTemplateList()},onSingleTemplateImported:async X=>{X.planTemplateId&&(d.setPlanTemplateId(X.planTemplateId),await d.load(X.planTemplateId))}})},b=async H=>{await r.handleStepSelected(H),setTimeout(()=>{D()},100),$()},P=async()=>{await r.refreshCurrentStep(),$()};be(()=>e.selectedStepId,async H=>{H?await b(H):r.clearSelectedStep()},{immediate:!0});const U=H=>{i.value=H??void 0},D=()=>{if(!i.value)return;const{scrollTop:H,scrollHeight:X,clientHeight:se}=i.value,Y=X-H-se<50,ne=X>se;k.value=Y,f.value=ne&&!Y,Y?E.value=!0:X-H-se>100&&(E.value=!1)},q=()=>{i.value&&(i.value.scrollTo({top:i.value.scrollHeight,behavior:"smooth"}),xe(()=>{E.value=!0,D()}))},$=()=>{!E.value||!i.value||xe(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},I=r.formatJson,T=()=>{E.value=!0,i.value&&i.value.removeEventListener("scroll",D)},O=()=>{const H=()=>{const X=i.value;return X?(U(X),X.addEventListener("scroll",D),E.value=!0,D(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};xe(()=>{H()||setTimeout(()=>{H()},100)})};return Me(()=>{console.log("[RightPanel] Component mounted"),xe(()=>{O()})}),Ue(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),T()}),t({handleStepSelected:b,refreshCurrentStep:P,updateDisplayedPlanProgress:H=>{r.updateDisplayedPlanProgress(H)}}),(H,X)=>(h(),g("div",tm,[o("div",sm,[o("div",om,[o("div",{class:ge(["tab-item",{active:S.value==="config"}]),onClick:X[0]||(X[0]=se=>S.value="config")},[x(p(F),{icon:"carbon:settings"}),o("span",null,c(p(s)("sidebar.configuration")),1)],2),o("div",{class:ge(["tab-item",{active:S.value==="details"}]),onClick:X[1]||(X[1]=se=>S.value="details")},[x(p(F),{icon:"carbon:events"}),o("span",null,c(p(s)("rightPanel.stepExecutionDetails")),1)],2),o("div",{class:ge(["tab-item",{active:S.value==="files"}]),onClick:X[2]||(X[2]=se=>S.value="files")},[x(p(F),{icon:"carbon:folder"}),o("span",null,c(p(s)("fileBrowser.title")),1)],2)])]),o("div",nm,[S.value==="config"?(h(),g("div",am,[p(d).selectedTemplate.value?(h(),g("div",lm,[o("div",rm,[o("div",im,[o("h3",null,c(p(d).selectedTemplate.value.title||p(s)("sidebar.unnamedPlan")),1),o("span",cm,"ID: "+c(p(d).selectedTemplate.value.planTemplateId),1)]),o("button",{class:"back-to-list-btn",onClick:X[3]||(X[3]=se=>p($s).switchToTab("list"))},[x(p(F),{icon:"carbon:arrow-left",width:"16"})])]),x(Yp),x(xc)])):(h(),g("div",um,[o("div",dm,[o("button",{class:"new-task-btn",onClick:W},[x(p(F),{icon:"carbon:add",width:"16"}),me(" "+c(p(s)("rightPanel.newFuncAgentPlan")),1)]),o("label",{class:"new-task-btn",title:p(s)("rightPanel.importExistingPlan")},[x(p(F),{icon:"carbon:import",width:"16"}),me(" "+c(p(s)("rightPanel.importExistingPlan"))+" ",1),o("input",{type:"file",accept:".json",onChange:L,style:{display:"none"}},null,32)],8,pm)]),o("p",mm,[me(c(p(s)("rightPanel.importDescription"))+" ",1),o("a",hm,c(p(s)("rightPanel.promptLibrary")),1),me(" "+c(p(s)("rightPanel.importDescriptionSuffix")),1)])]))])):B("",!0),S.value==="details"?(h(),g("div",fm,[m.value?(h(),g("div",vm,[o("h3",null,c(m.value.title||m.value.description||p(s)("rightPanel.defaultStepTitle",{number:1})),1),m.value.agentExecution?(h(),g("div",gm,[o("div",ym,[o("span",bm,c(p(s)("rightPanel.executingAgent"))+":",1),o("span",{class:"value",title:m.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(s)("chat.clickToViewExecutionDetails"):""},c(m.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(s)("chat.funcAgentExecutionDetails"):m.value.agentExecution.agentName),9,_m)]),o("div",wm,[o("span",$m,c(p(s)("rightPanel.callingModel"))+":",1),o("span",Sm,c(m.value.agentExecution.modelName),1)])])):B("",!0),o("div",Pm,[o("div",Tm,[m.value.completed?(h(),Se(p(F),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):m.value.current?(h(),Se(p(F),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),Se(p(F),{key:2,icon:"carbon:time",class:"status-icon pending"})),o("span",Em,c(N.value),1)])])])):B("",!0),o("div",{ref_key:"scrollContainer",ref:i,class:"step-details-scroll-container",onScroll:D},[m.value?(h(),g("div",km,[m.value.agentExecution?.thinkActSteps&&m.value.agentExecution.thinkActSteps.length>0?(h(),g("div",Cm,[o("h4",null,c(p(s)("rightPanel.thinkAndActionSteps")),1),o("div",Im,[(h(!0),g(fe,null,ye(m.value.agentExecution.thinkActSteps,(se,Y)=>(h(),g("div",{key:Y,class:"think-act-step"},[o("div",Rm,[o("span",xm,"#"+c(Y+1),1),o("span",{class:ge(["step-status",se.status])},c(se.status||p(s)("rightPanel.executing")),3)]),o("div",Am,[o("h5",null,[x(p(F),{icon:"carbon:thinking"}),me(" "+c(p(s)("rightPanel.thinking")),1)]),o("div",Fm,[o("div",Mm,[o("div",Dm,[o("span",Nm,c(p(s)("rightPanel.input"))+":",1),o("div",Um,[o("button",{class:"copy-btn",onClick:ne=>l(se.thinkInput),title:p(s)("rightPanel.copyToClipboard")},[x(p(F),{icon:"carbon:copy"})],8,Lm),o("span",Om,c(se.inputCharCount??0)+" chars",1)])]),o("div",qm,[o("pre",null,c(p(I)(se.thinkInput)),1)])]),o("div",Bm,[o("div",Hm,[o("span",Vm,c(p(s)("rightPanel.output"))+":",1),o("div",jm,[o("button",{class:"copy-btn",onClick:ne=>l(se.thinkOutput),title:p(s)("rightPanel.copyToClipboard")},[x(p(F),{icon:"carbon:copy"})],8,zm),o("span",Wm,c(se.outputCharCount??0)+" chars",1)])]),o("div",Gm,[o("pre",null,c(p(I)(se.thinkOutput)),1)])])])]),se.actionNeeded?(h(),g("div",Km,[o("h5",null,[x(p(F),{icon:"carbon:play"}),me(" "+c(p(s)("rightPanel.action")),1)]),o("div",Jm,[(h(!0),g(fe,null,ye(se.actToolInfoList||[],(ne,Pe)=>(h(),g("div",{key:`tool-${Pe}-${ne?.id||ne?.name||Pe}`,class:"tool-execution-item"},[o("div",Xm,[o("span",Ym,c(p(s)("rightPanel.tool"))+":",1),o("span",Qm,c(ne?.name||"N/A"),1)]),o("div",Zm,[o("span",eh,c(p(s)("rightPanel.toolParameters"))+":",1),o("pre",null,c(p(I)(ne?.parameters)),1)]),o("div",th,[o("span",sh,c(p(s)("rightPanel.executionResult"))+":",1),o("pre",null,c(p(I)(ne?.result)),1)])]))),128)),!se.actToolInfoList||se.actToolInfoList.length===0?(h(),g("div",oh,[o("p",null,c(p(s)("rightPanel.noToolsExecuted")),1)])):B("",!0)]),se.subPlanExecutionRecord?(h(),g("div",nh,[o("h5",null,[x(p(F),{icon:"carbon:tree-view"}),me(" "+c(p(s)("rightPanel.subPlan")),1)]),o("div",ah,[o("div",lh,[o("div",rh,[o("span",ih,c(H.$t("rightPanel.subPlanId"))+":",1),o("span",ch,c(se.subPlanExecutionRecord.currentPlanId),1)]),se.subPlanExecutionRecord.title?(h(),g("div",uh,[o("span",dh,c(H.$t("rightPanel.title"))+":",1),o("span",ph,c(se.subPlanExecutionRecord.title),1)])):B("",!0),o("div",mh,[se.subPlanExecutionRecord.completed?(h(),Se(p(F),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),Se(p(F),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),o("span",hh,c(se.subPlanExecutionRecord.completed?H.$t("rightPanel.status.completed"):H.$t("rightPanel.status.executing")),1)])])])])):B("",!0)])):B("",!0)]))),128))]),m.value.agentExecution&&!m.value.agentExecution.thinkActSteps?.length?(h(),g("div",fh,[o("p",null,c(p(s)("rightPanel.noStepDetails")),1)])):m.value.agentExecution?B("",!0):(h(),g("div",vh,[x(p(F),{icon:"carbon:information",class:"info-icon"}),o("h4",null,c(p(s)("rightPanel.stepInfo")),1),o("div",gh,[o("div",yh,[o("span",bh,c(p(s)("rightPanel.stepName"))+":",1),o("span",_h,c(m.value.title||m.value.description||m.value.stepId),1)]),m.value.description?(h(),g("div",wh,[o("span",$h,c(H.$t("rightPanel.description"))+":",1),o("span",Sh,c(m.value.description),1)])):B("",!0),o("div",Ph,[o("span",Th,c(H.$t("rightPanel.status.label"))+":",1),o("span",{class:ge(["value",{"status-completed":m.value.completed,"status-current":m.value.current,"status-pending":!m.value.completed&&!m.value.current}])},c(m.value.completed?H.$t("rightPanel.status.completed"):m.value.current?H.$t("rightPanel.status.executing"):H.$t("rightPanel.status.pending")),3)])]),o("p",Eh,c(p(s)("rightPanel.noExecutionInfo")),1)])),m.value.current&&!m.value.completed?(h(),g("div",kh,[X[4]||(X[4]=o("div",{class:"execution-waves"},[o("div",{class:"wave wave-1"}),o("div",{class:"wave wave-2"}),o("div",{class:"wave wave-3"})],-1)),o("p",Ch,[x(p(F),{icon:"carbon:in-progress",class:"rotating-icon"}),me(" "+c(p(s)("rightPanel.stepExecuting")),1)])])):B("",!0)])):(h(),g("div",Ih,[x(p(F),{icon:"carbon:events",class:"empty-icon"}),o("h3",null,c(p(s)("rightPanel.noStepSelected")),1),o("p",null,c(p(s)("rightPanel.selectStepHint")),1)]))])):B("",!0),x(_t,{name:"scroll-button"},{default:ze(()=>[f.value?(h(),g("button",{key:0,onClick:q,class:"scroll-to-bottom-btn",title:p(s)("rightPanel.scrollToBottom")},[x(p(F),{icon:"carbon:chevron-down"})],8,Rh)):B("",!0)]),_:1})],544)])):B("",!0),S.value==="files"?(h(),g("div",xh,[w.value?(h(),Se(ei,{key:0,"plan-id":w.value},null,8,["plan-id"])):v.value?(h(),g("div",Ah,[x(p(F),{icon:"carbon:folder-off"}),o("div",Fh,[o("h3",null,c(p(s)("fileBrowser.noFilesYet")),1),o("p",null,c(p(s)("fileBrowser.noPlanExecuting")),1),o("div",Mh,[x(p(F),{icon:"carbon:information"}),o("span",null,c(p(s)("fileBrowser.startTaskTip")),1)])])])):B("",!0)])):B("",!0)])]))}}),Nh=ke(Dh,[["__scopeId","data-v-d35a8db8"]]),Uh={class:"template-list-container"},Lh={class:"organization-section"},Oh={class:"organization-row"},qh={class:"organization-selector"},Bh={class:"organization-label"},Hh=["value"],Vh={value:"by_time"},jh={value:"by_abc"},zh={value:"by_group_time"},Wh={value:"by_group_abc"},Gh={class:"search-input-wrapper"},Kh={class:"search-label"},Jh={class:"search-input-container"},Xh=["placeholder"],Yh=["title"],Qh={class:"sidebar-content-list"},Zh={key:0,class:"loading-state"},ef={key:1,class:"error-state"},tf={key:2,class:"empty-state"},sf=["onClick","title"],of=["onClick","title"],nf={class:"group-name"},af={class:"group-count"},lf=["onClick"],rf={class:"task-icon"},cf={class:"task-details"},uf={class:"task-title"},df={class:"task-time"},pf={class:"task-actions"},mf=["title","onClick"],hf={class:"confirm-header"},ff={class:"confirm-content"},vf={class:"confirm-actions"},gf=["disabled"],yf=Ee({__name:"TemplateList",emits:["templateSelected"],setup(n,{emit:t}){const{t:e}=De(),s=Ge(),a=Wt(),l=wt(),r=A(""),d=A(!1),y=A(null),u=A(!1),i=t,f=L=>{const b=L.target;pe.setOrganizationMethod(b.value)},k=L=>{if(isNaN(L.getTime()))return console.warn("Invalid date received:",L),e("time.unknown");const P=new Date().getTime()-L.getTime(),U=Math.floor(P/6e4),D=Math.floor(P/36e5),q=Math.floor(P/864e5);return U<1?e("time.now"):U<60?e("time.minuteAgo",{count:U}):D<24?e("time.hourAgo",{count:D}):q<30?e("time.dayAgo",{count:q}):L.toLocaleDateString("zh-CN")},E=re(()=>{s.planTemplateList.value;const L=r.value.trim().toLowerCase(),b=pe.groupedTemplates;if(!L)return b;const P=new Map;for(const[U,D]of b){const q=[];for(const $ of D)($.title||"").toLowerCase().includes(L)&&q.push($);q.length>0&&P.set(U,q)}return P});be(r,L=>{s.planTemplateList.value;const b=L.trim().toLowerCase();if(!b||pe.organizationMethod!=="by_group_time"&&pe.organizationMethod!=="by_group_abc")return;const P=pe.groupedTemplates;for(const[U,D]of P){let q=!1;for(const $ of D)if(($.title||"").toLowerCase().includes(b)){q=!0;break}q&&pe.isGroupCollapsed(U)&&pe.toggleGroupCollapse(U)}});const m=L=>{const b=L??"null";return pe.groupCollapseState[b]??!1},S=L=>{pe.toggleGroupCollapse(L)},w=async L=>{a.setActiveTab("config"),await pe.selectTemplate(L),L.planTemplateId?(await s.load(L.planTemplateId),pe.hasTaskRequirementModified=!1):(s.reset(),pe.hasTaskRequirementModified=!1),i("templateSelected",L)},v=L=>{y.value=L,d.value=!0},N=async()=>{if(y.value){u.value=!0;try{await pe.deleteTemplate(y.value),d.value=!1,y.value=null,l.success(e("sidebar.deleteSuccess")||"Template deleted successfully")}catch(L){console.error("Failed to delete template:",L),l.error(e("sidebar.deleteFailed")||`Delete failed: ${L instanceof Error?L.message:String(L)}`)}finally{u.value=!1}}},W=()=>{d.value=!1,y.value=null};return(L,b)=>(h(),g(fe,null,[o("div",Uh,[o("div",Lh,[o("div",Oh,[o("div",qh,[o("label",Bh,c(L.$t("sidebar.organizationLabel")),1),o("select",{value:p(pe).organizationMethod,onChange:f,class:"organization-select"},[o("option",Vh,c(L.$t("sidebar.organizationByTime")),1),o("option",jh,c(L.$t("sidebar.organizationByAbc")),1),o("option",zh,c(L.$t("sidebar.organizationByGroupTime")),1),o("option",Wh,c(L.$t("sidebar.organizationByGroupAbc")),1)],40,Hh)]),o("div",Gh,[o("label",Kh,c(L.$t("sidebar.searchLabel")),1),o("div",Jh,[x(p(F),{icon:"carbon:search",width:"16",class:"search-icon"}),we(o("input",{"onUpdate:modelValue":b[0]||(b[0]=P=>r.value=P),type:"text",class:"search-input",placeholder:L.$t("sidebar.searchPlaceholder")||"Search..."},null,8,Xh),[[Ce,r.value]]),r.value?(h(),g("button",{key:0,class:"search-clear-btn",onClick:b[1]||(b[1]=P=>r.value=""),title:L.$t("sidebar.clearSearch")||"Clear search"},[x(p(F),{icon:"carbon:close",width:"14"})],8,Yh)):B("",!0)])])])]),o("div",Qh,[p(pe).isLoading?(h(),g("div",Zh,[x(p(F),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),o("span",null,c(L.$t("sidebar.loading")),1)])):p(pe).errorMessage?(h(),g("div",ef,[x(p(F),{icon:"carbon:warning",width:"20"}),o("span",null,c(p(pe).errorMessage),1),o("button",{onClick:b[2]||(b[2]=(...P)=>p(pe).loadPlanTemplateList&&p(pe).loadPlanTemplateList(...P)),class:"retry-btn"},c(L.$t("sidebar.retry")),1)])):p(s).planTemplateList.value.length===0?(h(),g("div",tf,[x(p(F),{icon:"carbon:document",width:"32"}),o("span",null,c(L.$t("sidebar.noTemplates")),1)])):(h(!0),g(fe,{key:3},ye(E.value,([P,U])=>(h(),g(fe,{key:P||"ungrouped"},[(p(pe).organizationMethod==="by_group_time"||p(pe).organizationMethod==="by_group_abc")&&U.length>0?(h(),g("div",{key:0,class:"group-header",onClick:$e(D=>S(P),["prevent"]),title:m(P)?L.$t("sidebar.expandGroup"):L.$t("sidebar.collapseGroup")},[o("button",{type:"button",class:"group-toggle-btn",onClick:$e(D=>S(P),["stop","prevent"]),title:m(P)?L.$t("sidebar.expandGroup"):L.$t("sidebar.collapseGroup")},[x(p(F),{icon:m(P)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,of),x(p(F),{icon:"carbon:folder",width:"16"}),o("span",nf,c(P===null||P===""?L.$t("sidebar.ungroupedMethods"):P),1),o("span",af,"("+c(U.length)+")",1)],8,sf)):B("",!0),(p(pe).organizationMethod==="by_group_time"||p(pe).organizationMethod==="by_group_abc")&&m(P)?B("",!0):(h(!0),g(fe,{key:1},ye(U,D=>(h(),g("div",{key:D.planTemplateId||"unknown",class:ge(["sidebar-content-list-item",{"sidebar-content-list-item-active":D.planTemplateId===p(s).currentPlanTemplateId.value,"grouped-item":p(pe).organizationMethod==="by_group_time"||p(pe).organizationMethod==="by_group_abc"}]),onClick:q=>w(D)},[o("div",rf,[x(p(F),{icon:"carbon:document",width:"20"})]),o("div",cf,[o("div",uf,c(D.title||L.$t("sidebar.unnamedPlan")),1)]),o("div",df,c(k(p(s).parseDateTime(D.updateTime||D.createTime))),1),o("div",pf,[o("button",{class:"delete-task-btn",title:L.$t("sidebar.deleteTemplate"),onClick:$e(q=>v(D),["stop"])},[x(p(F),{icon:"carbon:close",width:"16"})],8,mf)])],10,lf))),128))],64))),128))])]),(h(),Se(ws,{to:"body"},[x(_t,{name:"modal"},{default:ze(()=>[d.value?(h(),g("div",{key:0,class:"modal-overlay",onClick:W},[o("div",{class:"confirm-modal",onClick:b[3]||(b[3]=$e(()=>{},["stop"]))},[o("div",hf,[x(p(F),{icon:"carbon:warning",class:"warning-icon"}),o("h3",null,c(L.$t("sidebar.deleteConfirm")),1)]),o("div",ff,[o("p",null,c(L.$t("sidebar.deleteConfirmMessage",{templateName:y.value?.title||""})),1)]),o("div",vf,[o("button",{class:"confirm-btn cancel-btn",onClick:W},c(L.$t("common.cancel")),1),o("button",{class:"confirm-btn delete-btn",onClick:N,disabled:u.value},[x(p(F),{icon:u.value?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),me(" "+c(L.$t("common.delete")),1)],8,gf)])])])):B("",!0)]),_:1})]))],64))}}),bf=ke(yf,[["__scopeId","data-v-afbd5426"]]),_f={class:"sidebar-content"},wf={class:"sidebar-content-header"},$f={class:"sidebar-content-title"},Sf={class:"tab-content"},Pf=Ee({name:"SidebarPanel",__name:"Sidebar",props:{width:{}},setup(n,{expose:t}){const e=n,s=at(),a=Ge(),l=Wt(),r=async()=>{const d=a.getPlanType()||"dynamic_agent";await pe.createNewTemplate(d);const y=a.selectedTemplate.value;y&&(a.reset(),a.setPlanType(y.planType||"dynamic_agent"),y.planTemplateId&&a.setPlanTemplateId(y.planTemplateId),a.setTitle(y.title||"")),l.setActiveTab("config"),console.log("[Sidebar] ðŸ”„ Reloading available tools for new template"),await s.loadAvailableTools()};return Me(async()=>{await pe.loadPlanTemplateList(),s.loadAvailableTools()}),t({loadPlanTemplateList:pe.loadPlanTemplateList,toggleSidebar:$s.toggleSidebar}),(d,y)=>(h(),g("div",{class:"sidebar-wrapper",style:Ye({width:e.width+"%"})},[o("div",_f,[o("div",wf,[o("div",$f,c(d.$t("sidebar.title")),1),o("button",{class:"new-task-btn",onClick:r},[x(p(F),{icon:"carbon:add",width:"16"}),me(" "+c(d.$t("sidebar.newPlan")),1)])]),o("div",Sf,[x(bf)])])],4))}}),Tf=ke(Pf,[["__scopeId","data-v-0414be7c"]]);function Ef(){const n=et(),t=Ze(),{showToast:e}=Ps(),{t:s}=De(),a=u=>{const i={currentPlanId:u.currentPlanId,status:u.completed?"completed":"running"};return u.rootPlanId&&(i.rootPlanId=u.rootPlanId),u.summary&&(i.summary=u.summary),u.completed!==void 0&&(i.completed=u.completed),u.agentExecutionSequence&&(i.agentExecutionSequence=u.agentExecutionSequence),i},l=u=>{if(!u)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(u)){const[i,f,k,E=0,m=0,S=0,w=0]=u,v=new Date(i,f-1,k,E,m,S,Math.floor(w/1e6));return isNaN(v.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",u),new Date):v}if(typeof u=="string"){let i=new Date(u);if(!isNaN(i.getTime()))return i;const f=u.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(f){const[,k,E,m,S,w,v,N]=f;if(i=new Date(parseInt(k),parseInt(E)-1,parseInt(m),parseInt(S),parseInt(w),parseInt(v),N?parseInt(N.substring(0,3)):0),!isNaN(i.getTime()))return i}return!u.includes("Z")&&!u.includes("+")&&!u.includes("-",10)&&(i=new Date(u+"Z"),!isNaN(i.getTime()))?i:(console.warn("[useConversationHistory] Failed to parse date string:",u),new Date)}if(typeof u=="number"){const i=u.toString().length<13?u*1e3:u,f=new Date(i);return isNaN(f.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",u),new Date):f}return console.warn("[useConversationHistory] Unknown date format:",u,typeof u),new Date}catch(i){return console.warn("[useConversationHistory] Error parsing date:",u,i),new Date}},r=u=>{if(!u)return;console.log("[useConversationHistory] Processing record:",{userRequest:u.userRequest,startTime:u.startTime,startTimeType:typeof u.startTime,endTime:u.endTime,endTimeType:typeof u.endTime});const i=u.userRequest||u.title||"History Round",f=n.createDialog(i),k=Ie.getConversationId();if(k){const E=n.getDialog(f.id);E&&(E.conversationId=k,u.rootPlanId&&(E.planId=u.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",f.id,k))}if(u.userRequest&&u.startTime){const E=l(u.startTime);console.log("[useConversationHistory] Parsed date:",{original:u.startTime,parsed:E,parsedISO:E.toISOString(),isValid:!isNaN(E.getTime())});const m={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:u.userRequest,timestamp:E,isStreaming:!1};n.addMessageToDialog(f.id,m)}if(u.currentPlanId){const E=u.summary||u.result||u.message||"Execution completed",m=a(u),S={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:E,timestamp:u.endTime&&u.endTime?l(u.endTime):u.startTime?l(u.startTime):new Date,isStreaming:!1,planExecution:m};n.addMessageToDialog(f.id,S),u.rootPlanId&&t.setCachedPlanRecord(u.rootPlanId,m)}},d=async(u,i=!1,f=!0)=>{if(!u){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{i&&n.clearMessages(),Ie.setConversationId(u),n.setConversationId(u);const k=await ht.getConversationHistory(u);if(console.log("[useConversationHistory] Loaded conversation history:",k),k.length>0){const E=k[0];console.log("[useConversationHistory] Sample date formats:",{startTime:E.startTime,endTime:E.endTime,startTimeType:typeof E.startTime})}for(const E of k)r(E);console.log("[useConversationHistory] Successfully loaded conversation history with",k.length,"dialog rounds")}catch(k){throw console.error("[useConversationHistory] Failed to load conversation history:",k),f&&e(s("memory.loadHistoryFailed"),"error"),k}};return{loadConversationHistory:d,restoreConversationHistory:async u=>d(u,!1,!1),processHistoryRecord:r}}let Mt=null;function kf(){return Mt||(Mt=Ef()),Mt}const Cf={class:"direct-page"},If={class:"branding-header"},Rf={class:"branding-content"},xf={class:"branding-actions"},Af=["title"],Ff={class:"direct-chat"},Mf=["title"],Df=["title"],Nf={class:"chat-header"},Uf={class:"header-actions"},Lf=["title"],Of=["title"],qf={class:"chat-content"},Bf={class:"message-content"},Hf=Ee({name:"DirectIndex",__name:"index",setup(n){const t=fo(),e=vo(),s=yt(),{toast:a}=Ps(),l=et(),r=Ze(),d=kf(),y=A(""),u=A(),i=A(),f=A(null),k=A(50),E=A(80),m=A(!1),S=A(0),w=A(0),v=A(!1),N=A(0),W=A(0);Me(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),be(()=>r.planExecutionRecords,de=>{for(const[M,V]of de.entries())T(M)&&(u.value&&typeof u.value.updateDisplayedPlanProgress=="function"&&u.value.updateDisplayedPlanProgress(M),V.completed&&M===f.value&&(Array.from(de.entries()).some(([oe,ie])=>oe!==M&&ie&&!ie.completed&&ie.status!=="failed")?console.log("[Direct] Current plan completed but other plans are still running, keeping currentRootPlanId"):(console.log("[Direct] All plans completed, clearing currentRootPlanId"),f.value=null)))},{deep:!0}),be(()=>r.trackedPlanIds,de=>{if(!f.value&&de.value.size>0){const M=Array.from(de.value)[0];f.value=M,console.log("[Direct] Set currentRootPlanId to:",M)}},{deep:!0});const Y=Ie.getConversationId();if(Y&&(console.log("[Direct] Found saved conversationId, restoring conversation:",Y),xe(async()=>{try{await d.restoreConversationHistory(Y)}catch(de){console.error("[DirectView] Failed to restore conversation history:",de)}})),pe.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const de=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",de),de.trim()?(s.markTaskAsProcessed(),xe(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",de),await l.sendMessage({input:de})}catch(M){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",M),y.value=de}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(y.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",y.value),console.log("[Direct] No unprocessed task in store"));const ne=localStorage.getItem("directPanelWidth");ne&&(k.value=parseFloat(ne));const Pe=localStorage.getItem("sidebarWidth");Pe&&(E.value=parseFloat(Pe)),console.log("[Direct] Final prompt value:",y.value)}),be(()=>s.currentTask,Y=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",Y),Y&&!Y.processed&&Y.prompt.trim()){const ne=Y.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",ne),xe(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",ne),await l.sendMessage({input:ne})}catch(Pe){console.warn("[Direct] messageDialog.sendMessage failed for new task:",Pe)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),be(()=>y.value,(Y,ne)=>{console.log("[Direct] prompt value changed from:",ne,"to:",Y)},{immediate:!1}),Ue(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),f.value=null,r.cleanup(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",P),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",$)});const L=Y=>{m.value=!0,S.value=Y.clientX,w.value=k.value,document.addEventListener("mousemove",b),document.addEventListener("mouseup",P),document.body.style.cursor="col-resize",document.body.style.userSelect="none",Y.preventDefault()},b=Y=>{if(!m.value)return;const ne=window.innerWidth,de=-(Y.clientX-S.value)/ne*100;let M=w.value+de;M=Math.max(20,Math.min(80,M)),k.value=M},P=()=>{m.value=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",P),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",k.value.toString())},U=()=>{k.value=50,localStorage.setItem("directPanelWidth","50")},D=Y=>{v.value=!0,N.value=Y.clientX,W.value=E.value,document.addEventListener("mousemove",q),document.addEventListener("mouseup",$),document.body.style.cursor="col-resize",document.body.style.userSelect="none",Y.preventDefault()},q=Y=>{if(!v.value)return;const ne=window.innerWidth,de=(Y.clientX-N.value)/ne*100;let M=W.value+de;M=Math.max(15,Math.min(100,M)),E.value=M},$=()=>{v.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",$),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",E.value.toString())},I=()=>{E.value=80,localStorage.setItem("sidebarWidth","80")},T=(Y,ne=!1)=>!f.value||Y===f.value||ne&&(Y==="ui-state"||Y==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",Y,"current:",f.value),!1),O=Y=>{console.log("[DirectView] Step selected:",Y),u.value&&typeof u.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to config/preview panel:",Y),u.value.handleStepSelected(Y)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},J=()=>{e.push("/home")},H=()=>{e.push("/configs")},X=async()=>{if(Ie.selectMemoryId){console.log("[DirectView] Memory selected:",Ie.selectMemoryId);try{await d.loadConversationHistory(Ie.selectMemoryId,!0,!0)}catch(Y){console.error("[DirectView] Failed to load conversation history:",Y)}}},se=()=>{Ie.clearMemoryId(),Ie.clearConversationId(),l.reset()};return(Y,ne)=>(h(),g("div",Cf,[o("header",If,[o("div",Rf,[ne[1]||(ne[1]=o("div",{class:"branding-logo"},[o("img",{src:po,alt:"Lynxe",class:"java-logo"}),o("h1",null,"Lynxe")],-1)),o("div",xf,[x(yo),o("button",{class:"back-button",onClick:J},[x(p(F),{icon:"carbon:arrow-left"})]),o("button",{class:"config-button",onClick:H,title:Y.$t("direct.configuration")},[x(p(F),{icon:"carbon:settings-adjust",width:"20"})],8,Af)])])]),o("div",Ff,[x(Tf,{ref_key:"sidebarRef",ref:i,width:E.value},null,8,["width"]),o("div",{class:"panel-resizer",onMousedown:D,onDblclick:I,title:Y.$t("sidebar.resizeHint")},ne[2]||(ne[2]=[o("div",{class:"resizer-line"},null,-1)]),40,Mf),x(Nh,{ref_key:"rightPanelRef",ref:u,style:Ye({width:100-E.value-k.value+"%"}),"current-root-plan-id":f.value},null,8,["style","current-root-plan-id"]),o("div",{class:"panel-resizer",onMousedown:L,onDblclick:U,title:Y.$t("direct.panelResizeHint")},ne[3]||(ne[3]=[o("div",{class:"resizer-line"},null,-1)]),40,Df),o("div",{class:"left-panel",style:Ye({width:k.value+"%"})},[o("div",Nf,[o("h2",null,c(Y.$t("conversation")),1),o("div",Uf,[o("button",{class:"config-button",onClick:se,title:Y.$t("memory.newChat")},[x(p(F),{icon:"carbon:add",width:"20"})],8,Lf),o("button",{class:"cron-task-btn",onClick:ne[0]||(ne[0]=Pe=>p(Ie).toggleSidebar()),title:Y.$t("memory.selectMemory")},[x(p(F),{icon:"carbon:calendar",width:"20"})],8,Of)])]),o("div",qf,[x(ol,{onStepSelected:O})]),(h(),Se(Tl,{key:Y.$i18n.locale,"initial-value":y.value},null,8,["initial-value"]))],4)]),x(fr,{onMemorySelected:X}),p(a).show?(h(),g("div",{key:0,class:ge(["message-toast",p(a).type])},[o("div",Bf,[o("span",null,c(p(a).text),1)])],2)):B("",!0)]))}}),hv=ke(Hf,[["__scopeId","data-v-4b41408b"]]);export{hv as default};
//# sourceMappingURL=index-Q43Dys17.js.map
